<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zwigato | Food Delivery</title>
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHJ4PSI2IiBmaWxsPSIjRkZGRkZGIi8+CiAgPHRleHQgeD0iMTYiIHk9IjI0IiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtd2VpZ2h0PSI5MDAiIGZvbnQtc2l6ZT0iMjQiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IiNGRjUyMDAiPlo8L3RleHQ+Cjwvc3ZnPg==">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-rust': '#FF5200',
                        'primary-dark': '#E64A00',
                        'paper': '#FFFFFF',
                        'ink': '#02060C',
                        'cream': '#F0F0F5',
                        'gold': '#E2E3E7',
                        'earth': '#5B5F65',
                        'success': '#34C759',
                        'info': '#0A66C2'
                    },
                    fontFamily: {
                        'display': ["Plus Jakarta Sans", "Inter", "sans-serif"],
                        'heading': ["Plus Jakarta Sans", "Inter", "sans-serif"],
                        'body': ["Inter", "sans-serif"]
                    },
                    borderRadius: {
                        'xl': '12px',
                        '2xl': '16px',
                        '3xl': '24px',
                        'pill': '999px', // Added pill radius
                    },
                    boxShadow: {
                        'soft': '0 4px 12px rgba(0,0,0,0.05)',
                        'hover': '0 8px 24px rgba(0,0,0,0.1)'
                    },
                    animation: {
                        'dropdown-enter': 'dropdownEnter 0.2s ease-out forwards',
                        'fade': 'fade 0.2s ease-out',
                        'slideDown': 'slideDown 0.3s ease-out forwards',
                        'slideUp': 'slideUp 0.3s ease-out forwards',
                    },
                    keyframes: {
                        dropdownEnter: {
                            '0%': { opacity: '0', transform: 'translateY(-10px) scale(0.98)' },
                            '100%': { opacity: '1', transform: 'translateY(0) scale(1)' },
                        },
                        fade: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideDown: {
                            '0%': { opacity: '0', transform: 'translateY(-20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(100%)' },
                            '100%': { transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1" />
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@500;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --c-cream: #F0F0F5;
            --c-paper: #FFFFFF;
            --c-rust: #FF5200;
            --c-gold: #E2E3E7;
            --c-ink: #02060C;
            --c-earth: #5B5F65;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--c-cream);
            color: var(--c-ink);
            -webkit-font-smoothing: antialiased;
        }

        h1, h2, h3, .font-heading {
            font-family: 'Plus Jakarta Sans', sans-serif;
            letter-spacing: -0.02em;
        }

        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-slideUp {
            animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        .material-symbols-outlined.filled {
            font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        
        .zwigato-logo {
            font-family: 'Plus Jakarta Sans', sans-serif;
            font-weight: 800;
            letter-spacing: -0.03em;
            font-style: italic;
        }
        
        .hero-gradient {
            background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.2) 60%, transparent 100%);
        }

        .dropdown-scroll::-webkit-scrollbar {
            width: 4px;
        }
        .dropdown-scroll::-webkit-scrollbar-track {
            background: transparent;
        }
        .dropdown-scroll::-webkit-scrollbar-thumb {
            background-color: #E2E3E7;
            border-radius: 20px;
        }
    </style>
</head>

<body class="antialiased pb-24 bg-cream text-ink font-body overflow-x-hidden" onclick="handleBodyClick(event)">

    <div id="view-home" class="transition-opacity duration-300">
        <header class="relative md:sticky md:top-0 z-40 bg-white/95 backdrop-blur-md border-b border-gray-200 shadow-[0_2px_15px_rgba(0,0,0,0.03)] transition-all duration-300">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16 gap-4">
                    
                    <div class="flex items-center shrink-0">
                        <div class="h-10 w-auto flex items-center">
                            <div class="zwigato-logo text-2xl sm:text-3xl text-primary-rust pb-1 leading-normal cursor-pointer" onclick="window.scrollTo({top:0, behavior:'smooth'})">
                                Zwigato
                            </div>
                        </div>
                    </div>

                    <div class="hidden md:flex flex-1 max-w-xl mx-auto gap-3 items-center">
                        <div class="relative flex-1 group">
                            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 material-symbols-outlined group-focus-within:text-primary-rust transition-colors">search</span>
                            <input 
                                type="text" 
                                id="search-input-desktop"
                                placeholder="Search for 'Biryani' or 'Rolls'..." 
                                class="w-full bg-gray-100 border border-transparent focus:bg-white focus:border-primary-rust/50 focus:ring-4 focus:ring-primary-rust/10 rounded-full py-2.5 pl-10 pr-4 text-sm font-medium transition-all outline-none placeholder-gray-400 text-ink"
                                oninput="handleSearch(this.value)"
                            >
                        </div>
                        <button onclick="toggleFilterPanel()" class="flex items-center justify-center gap-2 px-4 py-2.5 bg-gray-100 hover:bg-white border border-transparent hover:border-gray-200 rounded-full transition-all active:scale-95 group relative">
                            <span class="material-symbols-outlined text-gray-500 group-hover:text-ink text-[20px]">tune</span>
                            <span class="text-sm font-medium text-gray-600 group-hover:text-ink">Filter</span>
                            <div id="filter-dot-desktop" class="hidden absolute top-2 right-2 w-2 h-2 bg-primary-rust rounded-full ring-1 ring-white"></div>
                        </button>
                    </div>

                    <div class="flex items-center gap-2 sm:gap-4">
                        
                        <div class="relative z-50 group" id="mode-selector-wrapper">
                            <button onclick="toggleModeDropdown(event)" id="mode-trigger" 
                                class="flex items-center gap-2 sm:gap-3 bg-white hover:bg-gray-50 active:bg-gray-100 border border-gray-200 rounded-full pl-1.5 pr-3 py-1.5 shadow-sm hover:shadow-md transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-rust/20">
                                
                                <div class="w-8 h-8 rounded-full bg-[#FFF6F3] flex items-center justify-center text-primary-rust shrink-0">
                                    <span id="trigger-icon" class="material-symbols-outlined text-[18px]">two_wheeler</span>
                                </div>

                                <div class="flex flex-col items-start text-left mr-1">
                                    <span class="text-[10px] uppercase tracking-wider font-bold text-gray-400 leading-none mb-0.5">Mode</span>
                                    <span id="trigger-label" class="text-sm font-bold text-ink leading-none">Delivery</span>
                                </div>

                                <span id="trigger-chevron" class="material-symbols-outlined text-gray-400 text-[20px] transition-transform duration-200 group-hover:text-ink">expand_more</span>
                            </button>

                            <div id="mode-dropdown" 
                                class="absolute top-full right-0 mt-3 w-64 bg-white rounded-2xl shadow-[0_10px_40px_-10px_rgba(0,0,0,0.15)] border border-gray-100 hidden origin-top-right overflow-hidden ring-1 ring-black/5 transform transition-all">
                                
                                <div class="p-2 space-y-1 dropdown-scroll max-h-[300px] overflow-y-auto">
                                    <button onclick="setGlobalOrderMode('Delivery')" class="w-full flex items-center gap-3 p-3 rounded-xl hover:bg-gray-50 transition-colors group text-left">
                                        <div class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-500 group-hover:bg-[#FFF6F3] group-hover:text-primary-rust transition-colors">
                                            <span class="material-symbols-outlined">two_wheeler</span>
                                        </div>
                                        <div>
                                            <p class="text-sm font-bold text-ink group-hover:text-primary-rust transition-colors">Delivery</p>
                                            <p class="text-[11px] text-gray-400">Direct to your door</p>
                                        </div>
                                        <span class="ml-auto material-symbols-outlined text-primary-rust opacity-0 group-hover:opacity-100 text-[18px]">check</span>
                                    </button>

                                    <button onclick="setGlobalOrderMode('Pickup')" class="w-full flex items-center gap-3 p-3 rounded-xl hover:bg-gray-50 transition-colors group text-left">
                                        <div class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-500 group-hover:bg-[#FFF6F3] group-hover:text-primary-rust transition-colors">
                                            <span class="material-symbols-outlined">shopping_bag</span>
                                        </div>
                                        <div>
                                            <p class="text-sm font-bold text-ink group-hover:text-primary-rust transition-colors">Pickup</p>
                                            <p class="text-[11px] text-gray-400">Skip the delivery fee</p>
                                        </div>
                                        <span class="ml-auto material-symbols-outlined text-primary-rust opacity-0 group-hover:opacity-100 text-[18px]">check</span>
                                    </button>

                                    <button onclick="setGlobalOrderMode('Dine-in')" class="w-full flex items-center gap-3 p-3 rounded-xl hover:bg-gray-50 transition-colors group text-left">
                                        <div class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-500 group-hover:bg-[#FFF6F3] group-hover:text-primary-rust transition-colors">
                                            <span class="material-symbols-outlined">restaurant</span>
                                        </div>
                                        <div>
                                            <p class="text-sm font-bold text-ink group-hover:text-primary-rust transition-colors">Dine-in</p>
                                            <p class="text-[11px] text-gray-400">Eat at the restaurant</p>
                                        </div>
                                        <span class="ml-auto material-symbols-outlined text-primary-rust opacity-0 group-hover:opacity-100 text-[18px]">check</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-8">
            
            <div class="md:hidden sticky top-0 z-50 bg-[#F0F0F5] pt-4 pb-2 shadow-sm transition-all">
                <div class="flex gap-2 items-center">
                    <div class="relative flex-1 group bg-white border border-[#E2E3E7] rounded-full shadow-[0_2px_8px_rgba(0,0,0,0.08)] flex items-center px-4 h-[44px]">
                        <span class="material-symbols-outlined text-gray-400">search</span>
                        <input 
                            type="text" 
                            id="search-input-mobile"
                            placeholder="Search for dishes..." 
                            class="w-full bg-transparent border-none focus:ring-0 text-[14px] font-medium text-[#02060C] placeholder-[#8A8F98] h-full ml-3 outline-none font-body"
                            oninput="handleSearch(this.value)"
                        >
                    </div>
                    <button onclick="toggleFilterPanel()" class="shrink-0 w-[44px] h-[44px] bg-white border border-[#E2E3E7] rounded-full flex items-center justify-center shadow-[0_2px_8px_rgba(0,0,0,0.08)] active:scale-95 transition-transform relative">
                        <span class="material-symbols-outlined text-gray-500">tune</span>
                        <div id="filter-dot-mobile" class="hidden absolute top-2 right-2 w-2 h-2 bg-primary-rust rounded-full ring-1 ring-white"></div>
                    </button>
                </div>
            </div>

            <div class="relative rounded-3xl overflow-hidden shadow-soft group h-[300px]">
                <img src="https://lh3.googleusercontent.com/aida-public/AB6AXuCZ45_EUYaZRXGCEjhoy96GfQ-qWNEHyhlw-lJ2SbWTty4i_tGRZpIHqnQWH-NpqwnV1RcFleCn_MZxX_0XPLQJd_AlPx9CpxFxazNm6-G1RttAruvA9mAv94vx7kvYcG-YMiOFkBCNtHJjDIo5U0aXT64xlpgenCGtfusvJSb9kFSIzw1cZvPhYpC_a8u50e3xP6X5hHXzcn5BOMKYMDFa0xzj6dY_dq8BGxuBdLy-XJFO7BhmQKo2hG5UKaYeFGCMc-3CVhylLgU"
                    alt="Hero"
                    class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-1000">
                <div class="absolute inset-0 hero-gradient flex flex-col justify-end p-6 sm:p-10">
                    <span class="inline-block px-3 py-1 bg-white/20 backdrop-blur-md text-white text-[11px] font-bold uppercase tracking-widest rounded-full mb-3 w-fit border border-white/30 font-body">
                        Trending Now
                    </span>
                    <h2 class="text-3xl sm:text-5xl text-white mb-4 leading-tight font-extrabold tracking-tight font-heading">
                        Best Food,<br><span class="text-primary-rust">Delivered Fast.</span>
                    </h2>
                    <button onclick="document.getElementById('category-nav').scrollIntoView({behavior: 'smooth'})"
                        class="bg-primary-rust hover:bg-primary-dark text-white px-6 py-3 rounded-xl font-bold shadow-lg shadow-orange-500/30 transition-all transform hover:-translate-y-1 w-fit flex items-center gap-2 font-body">
                        Order Now
                        <span class="material-symbols-outlined text-sm">arrow_downward</span>
                    </button>
                </div>
            </div>

            <div id="category-nav" class="sticky top-[68px] md:top-16 z-30 bg-[#F0F0F5]/95 backdrop-blur py-3 -mx-4 px-4 sm:mx-0 sm:px-0 border-b border-gray-200/50">
                <div class="flex gap-3 overflow-x-auto hide-scrollbar pb-1">
                    <button
                        class="category-btn flex items-center gap-2 px-4 py-2 rounded-full bg-primary-rust text-white border border-primary-rust shadow-sm shrink-0 transition-transform active:scale-95 text-sm font-semibold font-body"
                        data-category="all">
                        <span class="material-symbols-outlined text-[18px]">restaurant</span> All
                    </button>
                    <button
                        class="category-btn flex items-center gap-2 px-4 py-2 rounded-full bg-white text-ink border border-gray-200 hover:border-primary-rust hover:text-primary-rust shrink-0 transition-all active:scale-95 text-sm font-semibold shadow-sm font-body"
                        data-category="rolls">
                        <span class="material-symbols-outlined text-[18px]">fastfood</span> Rolls
                    </button>
                    <button
                        class="category-btn flex items-center gap-2 px-4 py-2 rounded-full bg-white text-ink border border-gray-200 hover:border-primary-rust hover:text-primary-rust shrink-0 transition-all active:scale-95 text-sm font-semibold shadow-sm font-body"
                        data-category="kebabs">
                        <span class="material-symbols-outlined text-[18px]">skillet</span> Kebabs
                    </button>
                    <button
                        class="category-btn flex items-center gap-2 px-4 py-2 rounded-full bg-white text-ink border border-gray-200 hover:border-primary-rust hover:text-primary-rust shrink-0 transition-all active:scale-95 text-sm font-semibold shadow-sm font-body"
                        data-category="biryani">
                        <span class="material-symbols-outlined text-[18px]">rice_bowl</span> Biryani
                    </button>
                    <button
                        class="category-btn flex items-center gap-2 px-4 py-2 rounded-full bg-white text-ink border border-gray-200 hover:border-primary-rust hover:text-primary-rust shrink-0 transition-all active:scale-95 text-sm font-semibold shadow-sm font-body"
                        data-category="desserts">
                        <span class="material-symbols-outlined text-[18px]">icecream</span> Desserts
                    </button>
                </div>
            </div>

            <section class="pb-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-bold text-ink tracking-tight font-heading">Recommended for you</h2>
                    <span id="search-count" class="text-sm font-medium text-earth hidden"></span>
                </div>
                <div id="menu-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    </div>
                <div id="no-results" class="hidden flex-col items-center justify-center py-12 text-center">
                    <span class="material-symbols-outlined text-4xl text-gray-300 mb-2">search_off</span>
                    <p class="text-earth font-medium">No dishes found matching your search.</p>
                    <button onclick="clearSearch()" class="mt-4 text-primary-rust font-bold hover:underline">Clear Search</button>
                </div>
            </section>
        </main>

        <div id="cart-bar" class="fixed bottom-6 left-1/2 -translate-x-1/2 w-[95%] max-w-md z-40 transition-transform duration-500 translate-y-[200%]">
            <div onclick="showCart()"
                class="bg-[#02060C] text-white p-3 pr-4 rounded-xl shadow-2xl flex items-center justify-between transform transition-transform hover:-translate-y-1 cursor-pointer border border-gray-800 backdrop-blur-xl">
                <div class="flex flex-col pl-2">
                    <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-0.5 font-body">Item Total</span>
                    <div class="flex items-baseline gap-2">
                        <span id="cart-count" class="font-bold text-base font-body">0 Items</span>
                        <span class="w-1 h-1 bg-gray-500 rounded-full"></span>
                        <span id="cart-total" class="font-bold text-base font-body">₹0</span>
                    </div>
                </div>
                <button class="bg-primary-rust hover:bg-primary-dark text-white px-4 py-2 rounded-lg font-bold text-sm tracking-wide transition-colors flex items-center gap-2 shadow-md font-body">
                    View Cart
                    <span class="material-symbols-outlined text-[16px]">shopping_bag</span>
                </button>
            </div>
        </div>
    </div> 

    <div id="view-cart" class="fixed inset-0 z-[60] bg-[#F0F0F5] hidden flex flex-col h-full overflow-hidden animate-slideUp">
        <header class="sticky top-0 z-50 bg-white px-4 py-4 flex items-center justify-between border-b border-gray-100 shadow-sm">
            <button onclick="goHome()" class="p-2 -ml-2 rounded-full hover:bg-gray-100 transition-colors active:scale-95 text-ink">
                <span class="material-symbols-outlined text-[24px]">arrow_back</span>
            </button>
            <h1 class="text-lg font-bold text-ink flex-1 text-center pr-8 tracking-tight font-heading">Your Cart</h1>
        </header>

        <div class="w-full bg-white py-3 flex items-center justify-center gap-2 border-b border-gray-100">
            <div class="flex items-center gap-1.5 opacity-90">
                <span class="material-symbols-outlined text-success text-[18px] filled">verified_user</span>
                <span class="text-[11px] font-bold text-ink tracking-wide uppercase font-body">Zwigato Promise</span>
            </div>
        </div>

        <div class="flex-1 w-full max-w-md mx-auto p-4 flex flex-col gap-5 overflow-y-auto pb-40">
            <div id="cart-items-container" class="flex flex-col gap-4"></div>

            <div class="bg-white rounded-2xl p-4 shadow-soft border border-gray-100">
                <div class="flex items-center gap-2 mb-3">
                    <span class="material-symbols-outlined text-earth text-[20px]">restaurant_menu</span>
                    <label class="text-sm font-bold text-ink uppercase tracking-wide font-body">Cooking Requests</label>
                </div>
                <input id="order-notes"
                    class="w-full bg-[#F6F7F9] border border-gray-200 rounded-xl p-3.5 text-sm text-ink placeholder-gray-400 focus:ring-2 focus:ring-primary-rust focus:border-transparent transition-all outline-none font-body"
                    placeholder="Add notes (e.g., less spicy)...">
            </div>

            <div class="bg-white rounded-2xl p-5 shadow-soft border border-gray-100">
                <h3 class="text-xs font-bold uppercase tracking-widest text-earth mb-4 flex items-center gap-2 font-body">
                    <span class="material-symbols-outlined text-[16px]">receipt_long</span> Bill Details
                </h3>
                <div class="space-y-3">
                    <div class="flex justify-between items-center text-sm text-ink font-body">
                        <span>Item Total</span>
                        <span id="cart-view-subtotal">₹0</span>
                    </div>
                    <div class="flex justify-between items-center text-sm text-ink font-body">
                        <span>Delivery Fee</span>
                        <span class="text-success font-medium">FREE</span>
                    </div>
                </div>
                <div class="my-4 border-t border-dashed border-gray-200"></div>
                <div class="flex justify-between items-center">
                    <span class="text-base font-bold text-ink font-heading">To Pay</span>
                    <div class="text-right">
                        <span id="cart-view-total" class="block text-xl font-bold text-primary-rust font-heading">₹0</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="fixed bottom-0 left-0 w-full z-40 bg-white border-t border-gray-100 p-4 pb-6 shadow-[0_-4px_20px_rgba(0,0,0,0.05)]">
            <div class="max-w-md mx-auto">
                <button onclick="showCheckout()"
                    class="w-full group relative bg-primary-rust hover:bg-primary-dark text-white font-bold text-base py-3.5 px-6 rounded-xl shadow-lg shadow-orange-500/20 flex items-center justify-between transition-all active:scale-[0.98]">
                    <div class="flex flex-col items-start pl-1">
                        <span class="text-[10px] uppercase tracking-wider opacity-90 font-semibold mb-[-2px] font-body">Total</span>
                        <span id="cart-footer-total" class="text-lg font-bold font-heading">₹0</span>
                    </div>
                    <div class="flex items-center gap-2 pr-1">
                        <span class="text-sm font-bold tracking-tight font-body">Review & Pay</span>
                        <div class="bg-white/10 rounded-full p-1 group-hover:bg-white/20 transition-colors">
                            <span class="material-symbols-outlined text-[20px] block">arrow_forward</span>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </div>


    <div id="view-checkout" class="fixed inset-0 z-[70] bg-[#F0F0F5] hidden flex flex-col h-full overflow-hidden animate-slideUp">
        <div class="sticky top-0 z-20 flex items-center bg-white p-4 pb-4 justify-between border-b border-gray-100 shadow-sm">
            <div onclick="showCart()"
                class="text-ink flex size-10 shrink-0 items-center justify-center rounded-full hover:bg-gray-100 transition-colors cursor-pointer">
                <span class="material-symbols-outlined text-2xl">arrow_back</span>
            </div>
            <h2 class="text-ink text-lg font-bold leading-tight flex-1 text-center pr-10 font-heading">Checkout</h2>
        </div>

        <div class="flex-1 overflow-y-auto pb-32 max-w-md mx-auto w-full">
            <div class="px-5 mt-6">
                <h2 class="text-ink text-base font-bold leading-tight mb-4 flex items-center gap-2 font-heading">
                    <span class="material-symbols-outlined text-primary-rust">location_on</span> Delivery Details
                </h2>
                <div class="space-y-4">
                    <div class="relative group">
                        <div class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none">
                            <span class="material-symbols-outlined text-[20px]">person</span>
                        </div>
                        <input id="input-name"
                            class="w-full h-12 pl-12 pr-4 rounded-xl bg-white border border-gray-200 focus:border-primary-rust focus:ring-1 focus:ring-primary-rust text-ink placeholder-gray-400 shadow-sm transition-all outline-none font-medium font-body"
                            placeholder="Your Name (Required)">
                    </div>
                    <div class="relative group">
                        <div class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none">
                            <span class="material-symbols-outlined text-[20px]">call</span>
                        </div>
                        <input id="input-phone"
                            class="w-full h-12 pl-12 pr-4 rounded-xl bg-white border border-gray-200 focus:border-primary-rust focus:ring-1 focus:ring-primary-rust text-ink placeholder-gray-400 shadow-sm transition-all outline-none font-medium font-body"
                            placeholder="Phone Number (Required)" type="tel">
                    </div>
                    <div class="relative group">
                        <div class="absolute left-4 top-4 text-gray-400 pointer-events-none">
                            <span class="material-symbols-outlined text-[20px]">home</span>
                        </div>
                        <textarea id="input-address"
                            class="w-full min-h-[100px] pl-12 pr-4 py-3 rounded-xl bg-white border border-gray-200 focus:border-primary-rust focus:ring-1 focus:ring-primary-rust text-ink placeholder-gray-400 shadow-sm transition-all outline-none font-medium resize-none font-body"
                            placeholder="Complete Address (House No, Building, Street, Area)"></textarea>
                    </div>
                </div>
            </div>

            <div class="p-5 mx-5 mt-6 bg-white rounded-2xl border border-gray-100 shadow-soft">
                <div class="flex justify-between gap-x-6 py-1">
                    <p class="text-earth text-sm font-medium font-body">Item Total</p>
                    <p id="checkout-subtotal" class="text-ink text-sm font-semibold text-right font-body">₹0</p>
                </div>
                <div class="w-full h-px bg-gray-100 my-3"></div>
                <div class="flex justify-between gap-x-6">
                    <p class="text-ink text-base font-bold font-heading">To Pay</p>
                    <p id="checkout-total" class="text-primary-rust text-base font-bold text-right font-heading">
                        ₹0
                    </p>
                </div>
            </div>
            <div class="h-8"></div>
        </div>

        <div class="absolute bottom-0 left-0 w-full p-4 bg-white border-t border-gray-100">
            <div class="max-w-md mx-auto">
                <button onclick="placeOrder()"
                    class="w-full h-12 bg-[#25D366] hover:bg-[#1ebc57] active:scale-[0.98] transition-all rounded-xl flex items-center justify-center gap-3 shadow-md group">
                    <span class="text-white font-bold text-base font-body">Confirm via WhatsApp</span>
                    <svg class="size-5 fill-white group-hover:rotate-12 transition-transform" viewbox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg">
                        <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.008-.57-.008-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z">
                        </path>
                    </svg>
                </button>
                <p class="text-center text-xs text-gray-400 mt-2 font-body">Ready to send order to Zwigato</p>
            </div>
        </div>
    </div>

    <div id="mode-modal" class="fixed inset-0 z-[90] bg-black/60 hidden flex items-center justify-center p-4 backdrop-blur-sm animate-fade">
        <div class="bg-white rounded-2xl w-full max-w-sm p-6 shadow-2xl scale-95 transition-transform duration-200" id="mode-modal-content">
            <h3 class="text-xl font-bold text-ink mb-2 font-heading">Ordering for?</h3>
            <p class="text-earth text-sm mb-6 font-body">Select how you want your food.</p>
            
            <div class="space-y-3">
                <button onclick="resolveModeModal('Delivery')" class="w-full flex items-center justify-between p-4 rounded-xl border border-gray-200 hover:border-primary-rust hover:bg-orange-50 transition-all group">
                    <span class="font-bold text-ink group-hover:text-primary-rust">Delivery</span>
                    <span class="material-symbols-outlined text-gray-400 group-hover:text-primary-rust">two_wheeler</span>
                </button>
                <button onclick="resolveModeModal('Pickup')" class="w-full flex items-center justify-between p-4 rounded-xl border border-gray-200 hover:border-primary-rust hover:bg-orange-50 transition-all group">
                    <span class="font-bold text-ink group-hover:text-primary-rust">Pickup</span>
                    <span class="material-symbols-outlined text-gray-400 group-hover:text-primary-rust">shopping_bag</span>
                </button>
                <button onclick="resolveModeModal('Dine-in')" class="w-full flex items-center justify-between p-4 rounded-xl border border-gray-200 hover:border-primary-rust hover:bg-orange-50 transition-all group">
                    <span class="font-bold text-ink group-hover:text-primary-rust">Dine-in</span>
                    <span class="material-symbols-outlined text-gray-400 group-hover:text-primary-rust">restaurant</span>
                </button>
            </div>
        </div>
    </div>

    <div id="filter-panel" class="fixed inset-0 z-[100] bg-black/50 hidden flex justify-center items-end md:items-center backdrop-blur-sm animate-fade">
        <div class="bg-white w-full max-w-md md:rounded-2xl rounded-t-2xl shadow-2xl flex flex-col max-h-[85vh] animate-slideUp">
            <div class="flex items-center justify-between p-5 border-b border-gray-100">
                <h3 class="text-lg font-bold text-ink font-heading">Filters</h3>
                <button onclick="toggleFilterPanel()" class="text-gray-400 hover:text-ink transition-colors">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            
            <div class="p-5 overflow-y-auto space-y-6">
                <div>
                    <h4 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-3">Type</h4>
                    <div class="flex gap-3">
                        <label class="flex items-center gap-2 cursor-pointer group">
                            <input type="checkbox" id="filter-veg" class="peer hidden" onchange="updateFilterState('veg', this.checked)">
                            <div class="w-5 h-5 border-2 border-gray-300 rounded peer-checked:bg-green-600 peer-checked:border-green-600 flex items-center justify-center transition-all">
                                <span class="material-symbols-outlined text-white text-[16px] opacity-0 peer-checked:opacity-100">check</span>
                            </div>
                            <span class="text-sm font-medium text-ink group-hover:text-green-600 transition-colors">Veg Only</span>
                        </label>
                    </div>
                </div>

                <div>
                    <h4 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-3">Price</h4>
                    <div class="flex flex-wrap gap-2">
                         <button onclick="updateFilterState('price', 'all')" id="price-all" class="price-btn px-4 py-2 rounded-full border border-gray-200 text-sm font-medium hover:border-primary-rust hover:text-primary-rust transition-all">Any</button>
                         <button onclick="updateFilterState('price', 'low')" id="price-low" class="price-btn px-4 py-2 rounded-full border border-gray-200 text-sm font-medium hover:border-primary-rust hover:text-primary-rust transition-all">Under ₹100</button>
                         <button onclick="updateFilterState('price', 'mid')" id="price-mid" class="price-btn px-4 py-2 rounded-full border border-gray-200 text-sm font-medium hover:border-primary-rust hover:text-primary-rust transition-all">₹100 - ₹300</button>
                         <button onclick="updateFilterState('price', 'high')" id="price-high" class="price-btn px-4 py-2 rounded-full border border-gray-200 text-sm font-medium hover:border-primary-rust hover:text-primary-rust transition-all">Over ₹300</button>
                    </div>
                </div>
            </div>

            <div class="p-5 border-t border-gray-100 flex gap-4">
                <button onclick="clearFilters()" class="flex-1 py-3 rounded-xl border border-gray-200 text-ink font-bold hover:bg-gray-50 transition-all">Clear</button>
                <button onclick="applyFilters()" class="flex-[2] py-3 rounded-xl bg-primary-rust text-white font-bold hover:bg-primary-dark shadow-lg shadow-orange-500/20 transition-all">Apply Filters</button>
            </div>
        </div>
    </div>

    <div id="toast-container"
        class="fixed bottom-32 left-1/2 -translate-x-1/2 z-[80] flex flex-col items-center gap-2 pointer-events-none">
    </div>

    <script>
        /**
         * ZWIGATO - Client Side Logic
         * Preserved functionality from Lucknow Wala
         */

        // --- 1. DATA: The Menu (BIOS + Visuals) ---
        const MENU_ITEMS = [
            {
                id: "roll-veg-kabab",
                name: "Veg Kabab Paratha Roll",
                category: "rolls",
                price: 30,
                description: "The classic starter. Soft paratha wrapped around spiced veg kababs.",
                image: "https://lh3.googleusercontent.com/aida-public/AB6AXuBu4XtsPQVQmzt-oply8j5oOkLj49rQG2-Cd5sczoIoNTc099N2jy-G0avyqsFxa4oBx39r79JppJNpVccRit4LN8fO7YQCZnyU-tBxq4qxhRjjTBpRO_-ht-uEUNTanAikYyK1gX2bwVsHyEZoqwDqt3GIOPXgQdqr2fchUMIsFN9bHTdpDO5TWwSTwQhKUb2TUgNDt1QTeR8llO5TTr9XROLj2q_B5YYOQozYQBD8Vh_i24B2PLpIo2vIAHowK5BtsIP4oFdgv90",
                isVeg: true,
                tag: "Hook"
            },
            {
                id: "roll-veg-paneer",
                name: "Veg Paneer Kabab Roll",
                category: "rolls",
                price: 40,
                description: "Upgrade to royalty. Soft paneer chunks with our signature spices.",
                image: "https://lh3.googleusercontent.com/aida-public/AB6AXuCTjXzJ_gtW9p5za_LWerjrpAIizMBfPlDFqAgODSuwB3PaMlAmTG1LUcWGMVWD-gEJl6WmYln0GAdtDRbxuLa8swxeUDeVjwBb5M4StIuy8YBZB4kUZ8F3EWDZTTgjD9DLfwI2f17F_31_Xcwepa0qEdp4pi8rt0ViHpd34yV03QLfIQzXAMPAZsGBOGN_wK3sMWNUwQR2vPl_OgeF1AcXI9uKhW44MgB3SjdoPuxln-OHocFqAD8EHz2rpcLWSKgq6dzxmd0FvvM",
                isVeg: true,
                tag: "Bestseller"
            },
            {
                id: "kebab-galouti",
                name: "Galouti Kebab (4 pcs)",
                category: "kebabs",
                price: 320,
                description: "Melt-in-mouth kebabs prepared with 150+ secret spices. The pride of Lucknow.",
                image: "https://lh3.googleusercontent.com/aida-public/AB6AXuBiEJd-nNkflydn5dWe2apbwEymsC7rdQ6Na4dNwBSDpat12CGtLFsje0TmgRCMKb2nwWXZzj9e3DPiiU-LU9a5tlReR3GsLPEKvN1lMrLwXpCOpQT-o2h6hqBP0xbDJ3snj6Q6g7dbLXo9wOpQjJmHzAjaeGbNcvyzmzz_D6vNPCXjbKne7G_CG0vXu9MFlEGTYP6RYWTjrEFhNmzmaIDXpnXOYCYM20VNTMZqmnEXKlnKrnpq6oSJWSf0bZITCxUGKLyIi7S7x9E",
                isVeg: false,
                tag: "Signature"
            },
            {
                id: "biryani-half",
                name: "Awadhi Chicken Biryani (Half)",
                category: "biryani",
                price: 60,
                description: "Long grain basmati rice cooked with succulent chicken and saffron.",
                image: "https://lh3.googleusercontent.com/aida-public/AB6AXuBFx9CZxnWoIJusoPUZgYvjy8IFo6YxqIKMv0fDByrfYXbhjeOdQNi3DJkzGvgPvTV_BFag-NceOGNLa6BsfIdqCoZCOCqkuIl84BJJsDC5S_Pc4DnPl_XTB8yfpAyThMGVG7YU1ubP2GnRO5I6Ijax0pWDFjQn_2vz0PVNiB-kDuNVRvRiMR431QeFHWSTsgAG88LuRxWuTGA9EMgf3YypQTGtQx4j89RCkhSWOFVofuvUdNjYcuC00Eawb1r3csic7VfHBvPy5OE",
                isVeg: false,
                tag: "Must Try"
            },
            {
                id: "biryani-full",
                name: "Awadhi Chicken Biryani (Full)",
                category: "biryani",
                price: 110,
                description: "The complete feast. More pieces, more rice, more happiness.",
                image: "https://lh3.googleusercontent.com/aida-public/AB6AXuBFx9CZxnWoIJusoPUZgYvjy8IFo6YxqIKMv0fDByrfYXbhjeOdQNi3DJkzGvgPvTV_BFag-NceOGNLa6BsfIdqCoZCOCqkuIl84BJJsDC5S_Pc4DnPl_XTB8yfpAyThMGVG7YU1ubP2GnRO5I6Ijax0pWDFjQn_2vz0PVNiB-kDuNVRvRiMR431QeFHWSTsgAG88LuRxWuTGA9EMgf3YypQTGtQx4j89RCkhSWOFVofuvUdNjYcuC00Eawb1r3csic7VfHBvPy5OE",
                isVeg: false,
            },
            {
                id: "nihari",
                name: "Nihari Gosht",
                category: "curries",
                price: 420,
                description: "Slow-cooked stew of meat shank and marrow bones.",
                image: "https://lh3.googleusercontent.com/aida-public/AB6AXuD-PMlITwONbLvoS9QvDpZDWkfReM6NyY3BJwB-N8V7GmMH07l7nR5kWnM1PCsBQNyHEfkI6VLyI2PxQlkWgVDPZbWEPg0r8TbZIr0BMGHQ9SvG77SWFL-8MbqycHRjNjTnk2OjKHdr939RrlX84_FRMQ3eBSPS7DZYorbMwSpwXcOBvI5ocLPIyuBcfCGp577ThS8we2jaue4iDG9IP3BfGQgtM3ioXzUZoNSjSd4RWgtCAog7hT59_jHQWWF_oz5R2TAfVvi6w0c",
                isVeg: false,
            },
            {
                id: "dessert-shahi",
                name: "Shahi Tukda",
                category: "desserts",
                price: 180,
                description: "Bread pudding dessert of fried bread slices soaked in hot milk with spices.",
                image: "https://lh3.googleusercontent.com/aida-public/AB6AXuD4JtH1VdyHqTowcQPBewPtHmnFJhsS6uXEUwIs6lDj6fLXl4NdwMOTqgpTxIiysk5eKnVO0ohjXPHO1wTGz-ZaINTgX-dr4Wis2ZTIfGJY7KJNCD7OaRN70RJJdFkeoVWgG3ZYoE4zxYUNdE38fh8-a7n9gPFjmLioLVw-v7-Q85qeJT_LHQkqklbMQqfs9tYlcONPcTWwvvIosMQI8IpQ0qTZCUrT4ipQWhnKUU0ggb5za4KlDK-GDMlM9HqpWHez_BBwP8Z_8-8",
                isVeg: true,
                tag: "Sweet Ending"
            }
        ];

        // --- 2. BOLTA MENU: Voice Interactions (Content preserved) ---
        const NAWABI_PHRASES = {
            add: ["Wah! Lazeez choice hai Janab!", "Behtareen peshkash!", "Shauk farmayein!"],
            remove: ["Koi baat nahi, kuch aur try karein?", "Dil chota na karein Janab."]
        };

        // --- 3. STATE MANAGEMENT ---
        let cart = {}; // { itemId: quantity } - Legacy cart for simple counts
        let currentCategory = 'all';
        let searchQuery = '';
        // NEW: Filter State
        let activeFilters = {
            veg: false,
            price: 'all' // all, low (<100), mid (100-300), high (>300)
        };
        let tempFilters = { ...activeFilters }; // For modal interaction
        
        // NEW: Feature 1 & 3 - Global Mode State & Detailed Cart
        let currentOrderMode = 'Delivery';
        let hasExplicitlySelectedMode = false;
        // detailedCart: { itemId: { 'Delivery': qty, 'Pickup': qty, ... } }
        let detailedCart = {};

        // --- 4. DOM ELEMENTS ---
        const menuContainer = document.getElementById('menu-grid');
        const cartBar = document.getElementById('cart-bar');
        const cartCount = document.getElementById('cart-count');
        const cartTotal = document.getElementById('cart-total');
        const toastContainer = document.getElementById('toast-container');
        const categoryButtons = document.querySelectorAll('.category-btn');

        // Overlays
        const viewHome = document.getElementById('view-home');
        const viewCart = document.getElementById('view-cart');
        const viewCheckout = document.getElementById('view-checkout');
        const filterPanel = document.getElementById('filter-panel');

        // Cart View Elements
        const cartItemsContainer = document.getElementById('cart-items-container');
        const cartViewSubtotal = document.getElementById('cart-view-subtotal');
        const cartViewTotal = document.getElementById('cart-view-total');
        const cartFooterTotal = document.getElementById('cart-footer-total');

        // Checkout View Elements
        const checkoutSubtotal = document.getElementById('checkout-subtotal');
        const checkoutTotal = document.getElementById('checkout-total');
        const inputName = document.getElementById('input-name');
        const inputPhone = document.getElementById('input-phone');
        const inputAddress = document.getElementById('input-address');
        const orderNotes = document.getElementById('order-notes');
        
        // New Modal Elements
        const modeModal = document.getElementById('mode-modal');
        const modeModalContent = document.getElementById('mode-modal-content');

        // --- 5. INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            // Load persisted cart if needed (Phase 2+)
            renderMenu();
            updateCartUI();
            setupCategoryFilters();
            updateModeSelectorUI();
            syncFilterUI();
        });

        // --- 6. CORE FUNCTIONS ---

        function renderMenu() {
            menuContainer.innerHTML = '';

            // 1. Filter by Category
            let itemsToShow = currentCategory === 'all'
                ? MENU_ITEMS
                : MENU_ITEMS.filter(item => item.category === currentCategory);

            // 2. Filter by Search
            if (searchQuery) {
                const query = searchQuery.toLowerCase();
                itemsToShow = itemsToShow.filter(item => 
                    item.name.toLowerCase().includes(query) || 
                    item.description.toLowerCase().includes(query) ||
                    item.category.toLowerCase().includes(query)
                );
            }

            // 3. Filter by Active Filters (Veg / Price)
            if (activeFilters.veg) {
                itemsToShow = itemsToShow.filter(item => item.isVeg);
            }
            if (activeFilters.price !== 'all') {
                itemsToShow = itemsToShow.filter(item => {
                    if (activeFilters.price === 'low') return item.price < 100;
                    if (activeFilters.price === 'mid') return item.price >= 100 && item.price <= 300;
                    if (activeFilters.price === 'high') return item.price > 300;
                    return true;
                });
            }

            // Show No Results
            const noResults = document.getElementById('no-results');
            const searchCount = document.getElementById('search-count');
            
            if (itemsToShow.length === 0) {
                noResults.classList.remove('hidden');
                noResults.classList.add('flex');
                if(searchQuery) searchCount.innerText = '';
            } else {
                noResults.classList.add('hidden');
                noResults.classList.remove('flex');
                if(searchQuery) {
                    searchCount.classList.remove('hidden');
                    searchCount.innerText = `Found ${itemsToShow.length} matches`;
                } else {
                    searchCount.classList.add('hidden');
                }
            }

            itemsToShow.forEach(item => {
                const cartQty = cart[item.id] || 0;

                const card = document.createElement('div');
                // Updated Visuals: White bg, softer borders, no colored border-left
                card.className = "bg-white rounded-2xl shadow-soft border border-gray-100 overflow-hidden hover:shadow-hover transition-all duration-300 group flex flex-col h-full";

                card.innerHTML = `
            <div class="relative h-44 overflow-hidden">
                <img src="${item.image}" alt="${item.name}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500">
                ${item.tag ? `<div class="absolute top-3 left-3 bg-white/90 backdrop-blur px-2 py-0.5 rounded text-[10px] font-bold shadow-sm uppercase tracking-wider text-primary-rust border border-gray-200 font-body">${item.tag}</div>` : ''}
            </div>
            
            <div class="p-4 flex flex-col flex-grow">
                <div class="flex justify-between items-start mb-1">
                    <h3 class="font-bold text-lg text-ink leading-tight group-hover:text-primary-rust transition-colors font-heading">${item.name}</h3>
                    <div class="border ${item.isVeg ? 'border-green-600' : 'border-primary-rust'} p-0.5 rounded-[4px] shrink-0 mt-1">
                        <div class="w-2 h-2 ${item.isVeg ? 'bg-green-600' : 'bg-primary-rust'} rounded-full"></div>
                    </div>
                </div>
                
                <p class="text-xs text-earth mb-4 line-clamp-2 font-body">${item.description}</p>
                
                <div class="mt-auto flex items-center justify-between">
                    <span class="font-bold text-lg text-ink font-heading">₹${item.price}</span>
                    
                    ${cartQty === 0 ? `
                        <button onclick="addToCart('${item.id}')" class="bg-white border border-gray-200 text-primary-rust hover:bg-[#FFF6F3] hover:border-primary-rust px-6 py-2 rounded-lg text-sm font-bold uppercase tracking-wide transition-all shadow-sm font-body">
                            ADD
                        </button>
                    ` : `
                        <div class="flex items-center bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm">
                            <button onclick="updateQuantity('${item.id}', -1)" class="px-3 py-1.5 text-earth hover:bg-gray-50 transition-colors font-bold text-lg font-body">-</button>
                            <span class="px-2 text-sm font-bold min-w-[20px] text-center text-primary-rust font-body">${cartQty}</span>
                            <button onclick="updateQuantity('${item.id}', 1)" class="px-3 py-1.5 text-primary-rust hover:bg-gray-50 transition-colors font-bold text-lg font-body">+</button>
                        </div>
                    `}
                </div>
            </div>
        `;
                menuContainer.appendChild(card);
            });
        }
        
        // NEW: Search Logic
        function handleSearch(query) {
            searchQuery = query.trim();
            // Sync mobile/desktop inputs
            document.getElementById('search-input-desktop').value = searchQuery;
            document.getElementById('search-input-mobile').value = searchQuery;
            
            if(searchQuery) {
                // Scroll to menu if searching
                document.getElementById('category-nav').scrollIntoView({behavior: 'smooth'});
            }
            
            renderMenu();
        }

        function clearSearch() {
            handleSearch('');
            document.getElementById('search-input-desktop').value = '';
            document.getElementById('search-input-mobile').value = '';
        }

        // NEW: Filter Logic
        function toggleFilterPanel() {
            if (filterPanel.classList.contains('hidden')) {
                filterPanel.classList.remove('hidden');
                // Reset temp to active
                tempFilters = { ...activeFilters };
                syncFilterUI();
            } else {
                filterPanel.classList.add('hidden');
            }
        }

        function updateFilterState(type, value) {
            tempFilters[type] = value;
            syncFilterUI();
        }

        function syncFilterUI() {
            // Veg
            document.getElementById('filter-veg').checked = tempFilters.veg;
            
            // Price Buttons
            document.querySelectorAll('.price-btn').forEach(btn => {
                btn.classList.remove('bg-primary-rust', 'text-white', 'border-primary-rust');
                btn.classList.add('bg-white', 'border-gray-200', 'text-ink'); // Reset default
                
                if (btn.id === `price-${tempFilters.price}`) {
                    btn.classList.remove('bg-white', 'border-gray-200', 'text-ink');
                    btn.classList.add('bg-primary-rust', 'text-white', 'border-primary-rust');
                }
            });
        }

        function applyFilters() {
            activeFilters = { ...tempFilters };
            toggleFilterPanel();
            renderMenu();
            updateFilterIndicators();
        }

        function clearFilters() {
            tempFilters = { veg: false, price: 'all' };
            applyFilters();
        }

        function updateFilterIndicators() {
            const hasFilters = activeFilters.veg || activeFilters.price !== 'all';
            const desktopDot = document.getElementById('filter-dot-desktop');
            const mobileDot = document.getElementById('filter-dot-mobile');
            
            if (hasFilters) {
                desktopDot.classList.remove('hidden');
                mobileDot.classList.remove('hidden');
            } else {
                desktopDot.classList.add('hidden');
                mobileDot.classList.add('hidden');
            }
        }
        
        // NEW: Feature 1 - Global Mode Logic (REFINED)
        function setGlobalOrderMode(mode) {
            currentOrderMode = mode;
            hasExplicitlySelectedMode = true;
            updateModeSelectorUI();
            toggleModeDropdown(); // Close dropdown after selection
        }

        // REFINED: Dropdown UI Logic
        const modeConfig = {
            'Delivery': { icon: 'two_wheeler', desc: 'Direct to your door' },
            'Pickup': { icon: 'shopping_bag', desc: 'Skip the delivery fee' },
            'Dine-in': { icon: 'restaurant', desc: 'Eat at the restaurant' }
        };

        function updateModeSelectorUI() {
            const label = document.getElementById('trigger-label');
            const icon = document.getElementById('trigger-icon');
            
            if(label && icon) {
                label.innerText = currentOrderMode;
                icon.innerText = modeConfig[currentOrderMode].icon;
            }

            // Update Active State in Dropdown
            const buttons = document.querySelectorAll('#mode-dropdown button');
            buttons.forEach(btn => {
                const modeName = btn.querySelector('p.font-bold').innerText;
                const checkIcon = btn.querySelector('.material-symbols-outlined.ml-auto');
                const iconContainer = btn.querySelector('.w-10');
                
                if (modeName === currentOrderMode) {
                    btn.classList.add('bg-orange-50');
                    checkIcon.classList.remove('opacity-0');
                    iconContainer.classList.add('bg-[#FFF6F3]', 'text-primary-rust');
                    iconContainer.classList.remove('bg-gray-100', 'text-gray-500');
                } else {
                    btn.classList.remove('bg-orange-50');
                    checkIcon.classList.add('opacity-0');
                    iconContainer.classList.remove('bg-[#FFF6F3]', 'text-primary-rust');
                    iconContainer.classList.add('bg-gray-100', 'text-gray-500');
                }
            });
        }

        function toggleModeDropdown(event) {
            if(event) event.stopPropagation();
            const dropdown = document.getElementById('mode-dropdown');
            const chevron = document.getElementById('trigger-chevron');
            
            if (dropdown.classList.contains('hidden')) {
                dropdown.classList.remove('hidden');
                dropdown.classList.add('animate-dropdown-enter');
                chevron.classList.add('rotate-180');
            } else {
                dropdown.classList.add('hidden');
                dropdown.classList.remove('animate-dropdown-enter');
                chevron.classList.remove('rotate-180');
            }
        }

        // Close dropdown when clicking outside
        function handleBodyClick(event) {
            const dropdown = document.getElementById('mode-dropdown');
            const trigger = document.getElementById('mode-trigger');
            
            if (!dropdown.classList.contains('hidden') && !trigger.contains(event.target) && !dropdown.contains(event.target)) {
                 dropdown.classList.add('hidden');
                 document.getElementById('trigger-chevron').classList.remove('rotate-180');
            }
        }

        // NEW: Feature 2 - Modal Logic
        let pendingItemId = null;
        
        function showModeModal() {
            modeModal.classList.remove('hidden');
            setTimeout(() => {
                modeModalContent.classList.remove('scale-95');
                modeModalContent.classList.add('scale-100');
            }, 10);
        }

        function resolveModeModal(mode) {
            setGlobalOrderMode(mode);
            modeModal.classList.add('hidden');
            if (pendingItemId) {
                addToCart(pendingItemId, true); // retry
                pendingItemId = null;
            }
        }

        function addToCart(itemId, silence = false) {
            // NEW: Feature 2 Interception
            const isFirstAdd = Object.keys(cart).length === 0;
            if (isFirstAdd && !hasExplicitlySelectedMode) {
                pendingItemId = itemId;
                showModeModal();
                return;
            }

            if (!cart[itemId]) cart[itemId] = 0;
            cart[itemId]++;

            // NEW: Feature 3 - Sticky Mode Logic
            // Initialize detailed entry if needed
            if (!detailedCart[itemId]) detailedCart[itemId] = {};
            if (!detailedCart[itemId][currentOrderMode]) detailedCart[itemId][currentOrderMode] = 0;
            
            detailedCart[itemId][currentOrderMode]++;

            if (!silence) speak(NAWABI_PHRASES.add);

            updateCartUI();
            renderMenu();
        }

        function updateQuantity(itemId, change) {
            if (!cart[itemId]) return;

            // NEW: Logic to handle removal/addition respecting current mode
            // When updating via Home Card, we assume currentOrderMode context
            
            if (change > 0) {
                // Add is simple, use current mode
                if (!detailedCart[itemId]) detailedCart[itemId] = {};
                if (!detailedCart[itemId][currentOrderMode]) detailedCart[itemId][currentOrderMode] = 0;
                detailedCart[itemId][currentOrderMode]++;
                cart[itemId]++;
            } else {
                // Remove logic
                // Try to remove from current mode first
                if (detailedCart[itemId] && detailedCart[itemId][currentOrderMode] > 0) {
                    detailedCart[itemId][currentOrderMode]--;
                    cart[itemId]--;
                } else {
                    // If current mode has 0, but total > 0, remove from ANY available mode
                    // This handles edge case where user switches mode and tries to decrement
                    const modes = Object.keys(detailedCart[itemId]);
                    for (let m of modes) {
                        if (detailedCart[itemId][m] > 0) {
                            detailedCart[itemId][m]--;
                            cart[itemId]--;
                            break;
                        }
                    }
                }
            }

            if (cart[itemId] <= 0) {
                delete cart[itemId];
                delete detailedCart[itemId];
                speak(NAWABI_PHRASES.remove);
            }

            updateCartUI();
            renderMenu(); // Updates Home Grid
            renderCartList(); // Updates Cart View if open
        }

        // NEW: Feature 4 - Cart Specific Update
        function updateCartModeQuantity(itemId, mode, change) {
            // Ensure structure exists
            if (!detailedCart[itemId]) detailedCart[itemId] = {};
            if (!detailedCart[itemId][mode]) detailedCart[itemId][mode] = 0;

            detailedCart[itemId][mode] += change;
            cart[itemId] += change; // Keep legacy total synced

            // Cleanup
            if (detailedCart[itemId][mode] <= 0) {
                delete detailedCart[itemId][mode];
            }
            if (cart[itemId] <= 0) {
                delete cart[itemId];
                delete detailedCart[itemId];
            }

            updateCartUI();
            renderMenu();
            renderCartList();
        }

        // NEW: Feature 4 - Move item between modes
        function moveItemMode(itemId, oldMode, newMode) {
            if (oldMode === newMode) return;
            
            if (detailedCart[itemId] && detailedCart[itemId][oldMode] > 0) {
                 detailedCart[itemId][oldMode]--;
                 
                 if (!detailedCart[itemId][newMode]) detailedCart[itemId][newMode] = 0;
                 detailedCart[itemId][newMode]++;
                 
                 if (detailedCart[itemId][oldMode] <= 0) delete detailedCart[itemId][oldMode];
            }
            
            updateCartUI();
            renderCartList();
        }

        function updateCartUI() {
            const totalQty = Object.values(cart).reduce((a, b) => a + b, 0);
            const totalPrice = Object.entries(cart).reduce((sum, [id, qty]) => {
                const item = MENU_ITEMS.find(i => i.id === id);
                return sum + (item.price * qty);
            }, 0);

            // 1. Home Bar
            if (totalQty > 0) {
                cartBar.classList.remove('translate-y-[200%]');
                cartCount.innerText = `${totalQty} Item${totalQty > 1 ? 's' : ''}`;
                cartTotal.innerText = `\u20B9${totalPrice}`;
            } else {
                cartBar.classList.add('translate-y-[200%]');
            }

            // 2. Cart View Totals
            const formattedTotal = `\u20B9${totalPrice}`;
            cartViewSubtotal.innerText = formattedTotal;
            cartViewTotal.innerText = formattedTotal;
            cartFooterTotal.innerText = formattedTotal;

            // 3. Checkout Totals
            checkoutSubtotal.innerText = formattedTotal;
            checkoutTotal.innerText = formattedTotal;
        }

        // --- 7. OVERLAY MANAGERS ---

        function showCart() {
            renderCartList();
            viewCart.classList.remove('hidden');
            viewCheckout.classList.add('hidden');
            document.body.style.overflow = 'hidden'; // Lock scroll
        }

        function showCheckout() {
            const totalQty = Object.values(cart).reduce((a, b) => a + b, 0);
            if (totalQty === 0) {
                showToast("Cart is empty Janab!");
                return;
            }
            viewCheckout.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function goHome() {
            viewCart.classList.add('hidden');
            viewCheckout.classList.add('hidden');
            document.body.style.overflow = '';
        }

        function renderCartList() {
            cartItemsContainer.innerHTML = '';

            if (Object.keys(cart).length === 0) {
                cartItemsContainer.innerHTML = `<div class="text-center py-10 text-earth opacity-50 font-bold font-body">Your cart is empty...</div>`;
                return;
            }

            // NEW: Feature 4 - Group by Mode
            const modes = ['Delivery', 'Pickup', 'Dine-in'];
            
            modes.forEach(mode => {
                // Check if any items exist for this mode
                let itemsInMode = [];
                Object.keys(detailedCart).forEach(itemId => {
                    if (detailedCart[itemId][mode] > 0) {
                        itemsInMode.push({ id: itemId, qty: detailedCart[itemId][mode] });
                    }
                });

                if (itemsInMode.length > 0) {
                    // Render Section Header
                    const header = document.createElement('div');
                    header.className = "flex items-center gap-2 mb-2 mt-2";
                    header.innerHTML = `
                        <span class="px-2 py-1 bg-gray-100 rounded text-xs font-bold text-gray-500 uppercase tracking-wider">${mode} Order</span>
                        <div class="h-px bg-gray-100 flex-1"></div>
                    `;
                    cartItemsContainer.appendChild(header);

                    // Render Items
                    itemsInMode.forEach(({ id, qty }) => {
                        const item = MENU_ITEMS.find(i => i.id === id);
                        const el = document.createElement('div');
                        el.className = "group relative bg-white rounded-2xl p-3 flex gap-4 shadow-sm border border-gray-100";
                        
                        // Mode Dropdown Builder
                        const otherModes = modes.filter(m => m !== mode);
                        let dropdownOptions = otherModes.map(m => 
                            `<option value="${m}">Move to ${m}</option>`
                        ).join('');

                        el.innerHTML = `
                            <div class="shrink-0 w-24 h-24 rounded-xl bg-gray-50 overflow-hidden relative shadow-inner">
                                <img src="${item.image}" class="w-full h-full object-cover">
                            </div>
                            <div class="flex-1 flex flex-col justify-between py-0.5">
                                <div>
                                    <div class="flex items-start justify-between gap-2">
                                        <div class="flex flex-col w-full">
                                            <div class="flex items-center justify-between gap-1.5 mb-1 w-full">
                                                <div class="flex items-center gap-1.5">
                                                    <div class="border ${item.isVeg ? 'border-green-600' : 'border-primary-rust'} p-0.5 rounded-[3px] w-4 h-4 flex items-center justify-center">
                                                        <div class="w-2 h-2 ${item.isVeg ? 'bg-green-600' : 'bg-primary-rust'} rounded-full"></div>
                                                    </div>
                                                    <h3 class="font-bold text-base text-ink leading-tight line-clamp-2 font-heading">${item.name}</h3>
                                                </div>
                                                
                                                <select onchange="moveItemMode('${id}', '${mode}', this.value)" class="text-[10px] bg-gray-50 border border-gray-200 rounded px-1 py-0.5 text-earth focus:outline-none">
                                                    <option selected disabled>${mode}</option>
                                                    ${dropdownOptions}
                                                </select>
                                            </div>
                                            <p class="text-xs text-earth line-clamp-1 font-body">${item.description}</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex justify-between items-end mt-2">
                                    <p class="font-bold text-lg text-ink font-heading">₹${item.price}</p>
                                    <div class="flex items-center bg-white rounded-lg border border-gray-200 h-8 shadow-sm overflow-hidden">
                                        <button onclick="updateCartModeQuantity('${item.id}', '${mode}', -1)" class="w-9 h-full flex items-center justify-center text-earth hover:bg-gray-50 transition-colors font-bold text-lg font-body">-</button>
                                        <span class="w-6 text-center text-sm font-bold text-primary-rust tabular-nums font-body">${qty}</span>
                                        <button onclick="updateCartModeQuantity('${item.id}', '${mode}', 1)" class="w-9 h-full flex items-center justify-center text-primary-rust hover:bg-gray-50 transition-colors font-bold text-lg font-body">+</button>
                                    </div>
                                </div>
                            </div>
                        `;
                        cartItemsContainer.appendChild(el);
                    });
                }
            });
        }

        // --- 8. WHATSAPP LOGIC ---

        function placeOrder() {
            const name = inputName.value.trim();
            const phone = inputPhone.value.trim();
            const address = inputAddress.value.trim();
            const notes = orderNotes.value.trim();

            if (!name || !phone) {
                showToast("Please enter Name & Phone number!");
                return;
            }

            let message = `*New Order from ${name}*\n`;
            message += `Phone: ${phone}\n`;
            if (address) message += `Address: ${address}\n`;
            message += `----------------\n`;

            let total = 0;
            // NEW: Feature 5 - Mixed Order Handling in Payload
            const modes = ['Delivery', 'Pickup', 'Dine-in'];
            
            modes.forEach(mode => {
                let hasItems = false;
                let sectionTotal = 0;
                let sectionMsg = `\n*--- ${mode} Items ---*\n`;
                
                Object.keys(detailedCart).forEach(id => {
                    const qty = detailedCart[id][mode] || 0;
                    if (qty > 0) {
                        hasItems = true;
                        const item = MENU_ITEMS.find(i => i.id === id);
                        const itemTotal = item.price * qty;
                        sectionTotal += itemTotal;
                        total += itemTotal;
                        sectionMsg += `${qty}x ${item.name} - \u20B9${itemTotal}\n`;
                    }
                });
                
                if (hasItems) {
                    message += sectionMsg;
                }
            });

            message += `----------------\n`;
            message += `*Total Bill: \u20B9${total}*\n`;
            if (notes) message += `Instructions: ${notes}\n`;

            const encodedMsg = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/919876543210?text=${encodedMsg}`;

            // Clear cart (optional)
            // cart = {}; updateCartUI(); renderMenu(); goHome();

            window.open(whatsappUrl, '_blank');
        }

        // --- UTILS ---
        function setupCategoryFilters() {
            categoryButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    categoryButtons.forEach(b => {
                        // Reset all buttons to default style
                        b.classList.remove('bg-primary-rust', 'text-white', 'border-primary-rust');
                        b.classList.add('bg-white', 'text-ink', 'border-gray-200');
                    });
                    // Active button style
                    btn.classList.remove('bg-white', 'text-ink', 'border-gray-200');
                    btn.classList.add('bg-primary-rust', 'text-white', 'border-primary-rust');
                    currentCategory = btn.dataset.category;
                    renderMenu();
                });
            });
        }
        
        // NEW: Mobile toggle logic
        function toggleMobileModeDropdown() {
             const modes = ['Delivery', 'Pickup', 'Dine-in'];
             const nextIndex = (modes.indexOf(currentOrderMode) + 1) % modes.length;
             setGlobalOrderMode(modes[nextIndex]);
        }

        function speak(phrasesArray) {
            const phrase = phrasesArray[Math.floor(Math.random() * phrasesArray.length)];
            showToast(phrase);
        }

        function showToast(message) {
            const toast = document.createElement('div');
            // Toast Visual Update: Darker, cleaner
            toast.className = "transform transition-all duration-500 translate-y-10 opacity-0 bg-[#333333] text-white px-6 py-3 rounded-full shadow-lg flex items-center gap-3 border border-gray-700 min-w-max z-[100]";
            toast.innerHTML = `<span class="tracking-wide text-sm font-medium font-body">${message}</span>`;
            toastContainer.appendChild(toast);
            requestAnimationFrame(() => toast.classList.remove('translate-y-10', 'opacity-0'));
            setTimeout(() => {
                toast.classList.add('translate-y-10', 'opacity-0');
                setTimeout(() => toast.remove(), 500);
            }, 3000);
        }

    </script>
</body>

</html>
