<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zwigato | Food Delivery</title>
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHJ4PSI2IiBmaWxsPSIjRkZGRkZGIi8+CiAgPHRleHQgeD0iMTYiIHk9IjI0IiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtd2VpZ2h0PSI5MDAiIGZvbnQtc2l6ZT0iMjQiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IiNGRjUyMDAiPlo8L3RleHQ+Cjwvc3ZnPg==">

    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-rust': '#FF5200',
                        'primary-dark': '#E64A00',
                        'paper': '#FFFFFF',
                        'ink': '#02060C',
                        'cream': '#F9F9FB',
                        'gold': '#E2E3E7',
                        'earth': '#5B5F65',
                        'success': '#34C759', // Swiggy Green
                        'info': '#0A66C2',
                        'brand-bg': '#FFF0EB'
                    },
                    fontFamily: {
                        'display': ["Plus Jakarta Sans", "Inter", "sans-serif"],
                        'heading': ["Plus Jakarta Sans", "Inter", "sans-serif"],
                        'body': ["Inter", "sans-serif"]
                    },
                    borderRadius: {
                        'xl': '12px',
                        '2xl': '20px',
                        '3xl': '24px',
                        'pill': '999px',
                    },
                    boxShadow: {
                        'soft': '0 8px 24px rgba(0,0,0,0.04)',
                        'hover': '0 12px 32px rgba(0,0,0,0.08)',
                        'nav': '0 -4px 20px rgba(0,0,0,0.03)',
                        'float': '0 10px 40px -10px rgba(0,0,0,0.2)',
                        'sticky-footer': '0 -10px 30px -5px rgba(0, 0, 0, 0.1)',
                    },
                    backgroundImage: {
                        'hero-pattern': "linear-gradient(to bottom, #FFF0EB 0%, #FFFFFF 100%)",
                        'shimmer': "linear-gradient(45deg, rgba(255,255,255,0.15) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.15) 50%, rgba(255,255,255,0.15) 75%, transparent 75%, transparent)"
                    },
                    animation: {
                        'dropdown-enter': 'dropdownEnter 0.2s ease-out forwards',
                        'fade': 'fade 0.2s ease-out',
                        'slideDown': 'slideDown 0.3s ease-out forwards',
                        'slideUp': 'slideUp 0.3s ease-out forwards',
                    },
                    keyframes: {
                        dropdownEnter: {
                            '0%': { opacity: '0', transform: 'translateY(-10px) scale(0.98)' },
                            '100%': { opacity: '1', transform: 'translateY(0) scale(1)' },
                        },
                        fade: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideDown: {
                            '0%': { opacity: '0', transform: 'translateY(-20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(100%)' },
                            '100%': { transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1" />
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@500;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --c-cream: #F9F9FB;
            --c-paper: #FFFFFF;
            --c-rust: #FF5200;
            --c-ink: #02060C;
        }

        html {
            overflow-x: hidden;
            width: 100%;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--c-cream);
            color: var(--c-ink);
            -webkit-font-smoothing: antialiased;
            padding-bottom: 0; 
            overflow-x: hidden;
            width: 100%;
        }

        h1, h2, h3, .font-heading {
            font-family: 'Plus Jakarta Sans', sans-serif;
            letter-spacing: -0.02em;
        }

        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .zwigato-logo {
            font-family: 'Plus Jakarta Sans', sans-serif;
            font-weight: 800;
            letter-spacing: -0.03em;
            font-style: italic;
        }

        .filled-icon {
            font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }

        .text-gradient {
            background: linear-gradient(90deg, #FF5200 0%, #FF8A00 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* New Styles for Cart & Checkout */
        .dropdown-group.active .dropdown-menu {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
            visibility: visible;
        }
        .dropdown-group.active .group-focus\:rotate-180 {
             transform: rotate(180deg);
        }
        .item-card.z-active {
            z-index: 50 !important;
        }
        .section-group.z-priority {
            z-index: 50 !important;
            position: relative;
        }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #E5E7EB; border-radius: 20px; }
        
        .sheet-overlay {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        .sheet-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }
    </style>
</head>

<body class="antialiased text-ink font-body" onclick="handleBodyClick(event)">

    <div id="view-home" class="transition-opacity duration-300 w-full">
        
        <!-- HEADER -->
        <header id="main-header" class="sticky top-0 z-40 bg-[#FFF0EB] pt-2 pb-2 transition-all duration-300 border-b border-transparent">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-14">
                    
                    <!-- Left: Logo & Location -->
                    <div class="flex flex-col items-start -space-y-0.5">
                        <div class="zwigato-logo text-2xl text-ink leading-normal cursor-pointer" onclick="window.scrollTo({top:0, behavior:'smooth'})">
                            Zwigato<span class="text-primary-rust">.</span>
                        </div>
                        
                        <div class="relative z-[60]">
                            <button onclick="toggleLocationDropdown(event)" id="location-trigger" class="flex items-center gap-0.5 group cursor-pointer active:scale-95 transition-transform">
                                <span id="current-location" class="text-[11px] font-bold text-earth group-hover:text-primary-rust transition-colors">Lucknow, India</span>
                                <span id="location-chevron" class="material-symbols-outlined text-[14px] text-earth group-hover:text-primary-rust transition-colors transition-transform duration-200">expand_more</span>
                            </button>

                            <div id="location-dropdown" class="absolute top-full left-0 mt-2 w-48 bg-white rounded-2xl shadow-xl border border-gray-100 hidden origin-top-left overflow-hidden">
                                <div class="p-1">
                                    <div class="px-3 py-2 text-[10px] uppercase font-bold text-gray-400 tracking-widest border-b border-gray-50 mb-1">Select Branch</div>
                                    <button onclick="updateLocation('Lucknow, India')" class="w-full text-left px-3 py-2 hover:bg-orange-50 rounded-xl text-xs font-bold text-ink hover:text-primary-rust transition-colors">Lucknow, India</button>
                                    <button onclick="updateLocation('Indira Nagar')" class="w-full text-left px-3 py-2 hover:bg-orange-50 rounded-xl text-xs font-bold text-ink hover:text-primary-rust transition-colors">Indira Nagar</button>
                                    <button onclick="updateLocation('Gomti Nagar')" class="w-full text-left px-3 py-2 hover:bg-orange-50 rounded-xl text-xs font-bold text-ink hover:text-primary-rust transition-colors">Gomti Nagar</button>
                                    <button onclick="updateLocation('Hazratganj')" class="w-full text-left px-3 py-2 hover:bg-orange-50 rounded-xl text-xs font-bold text-ink hover:text-primary-rust transition-colors">Hazratganj</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right: Mode Selector -->
                    <div class="flex items-center gap-3">
                        <div class="relative z-50 group" id="mode-selector-wrapper">
                            <button onclick="toggleModeDropdown(event)" id="mode-trigger" 
                                class="flex items-center gap-2 bg-white hover:bg-orange-50 active:bg-orange-100 border border-gray-200/50 rounded-full px-3 py-1.5 shadow-sm transition-all duration-200 ring-1 ring-gray-100">
                                <span id="trigger-icon" class="material-symbols-outlined text-primary-rust text-[18px]">two_wheeler</span>
                                <span id="trigger-label" class="text-xs font-bold text-ink leading-none">Delivery</span>
                                <span id="trigger-chevron" class="material-symbols-outlined text-gray-400 text-[18px]">expand_more</span>
                            </button>

                            <div id="mode-dropdown" class="absolute top-full right-0 mt-3 w-56 bg-white rounded-2xl shadow-xl border border-gray-100 hidden origin-top-right overflow-hidden z-[60]">
                                <div class="p-2 space-y-1">
                                    <button onclick="setGlobalOrderMode('Delivery')" class="w-full flex items-center gap-3 p-3 rounded-xl hover:bg-gray-50 transition-colors group text-left">
                                        <span class="material-symbols-outlined text-gray-400 group-hover:text-primary-rust">two_wheeler</span>
                                        <span class="text-sm font-bold text-ink group-hover:text-primary-rust">Delivery</span>
                                    </button>
                                    <button onclick="setGlobalOrderMode('Pickup')" class="w-full flex items-center gap-3 p-3 rounded-xl hover:bg-gray-50 transition-colors group text-left">
                                        <span class="material-symbols-outlined text-gray-400 group-hover:text-primary-rust">shopping_bag</span>
                                        <span class="text-sm font-bold text-ink group-hover:text-primary-rust">Pickup</span>
                                    </button>
                                    <button onclick="setGlobalOrderMode('Dine-in')" class="w-full flex items-center gap-3 p-3 rounded-xl hover:bg-gray-50 transition-colors group text-left">
                                        <span class="material-symbols-outlined text-gray-400 group-hover:text-primary-rust">restaurant</span>
                                        <span class="text-sm font-bold text-ink group-hover:text-primary-rust">Dine-in</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-4">
            
            <!-- HERO SECTION -->
            <section class="pt-6 pb-2 md:pt-12 md:pb-8 relative">
                <div class="absolute -top-20 left-1/2 -translate-x-1/2 w-[150%] h-[140%] bg-gradient-to-b from-[#FFF0EB] to-transparent -z-10 rounded-b-[50%] opacity-100"></div>

                <div class="flex flex-col items-center text-center max-w-2xl mx-auto">
                    <span class="text-[10px] font-bold tracking-widest text-primary-rust uppercase mb-3 bg-white px-3 py-1 rounded-full shadow-sm">No.1 in Town</span>
                    <h1 class="text-4xl sm:text-5xl md:text-6xl font-extrabold leading-[1.05] text-ink tracking-tight mb-8 font-heading">
                        Order food you<br>
                        <span class="text-gradient">absolutely love.</span>
                    </h1>
                    
                    <!-- Search Input -->
                    <div class="relative w-full shadow-lg shadow-orange-500/10 rounded-2xl group transition-all duration-300 hover:shadow-xl hover:shadow-orange-500/15 bg-white p-2 flex items-center border border-gray-100">
                        <div class="pl-3 pr-2">
                            <span class="material-symbols-outlined text-primary-rust/80">search</span>
                        </div>
                        <input 
                            type="text" 
                            id="search-input-hero"
                            placeholder="Search for 'Biryani' or 'Rolls'..." 
                            class="w-full bg-transparent border-none focus:ring-0 text-lg font-medium text-ink placeholder-gray-300 outline-none h-12 font-body flex-1"
                            oninput="handleSearch(this.value)"
                        >
                        
                        <!-- Filter Button Inline -->
                        <div class="flex items-center gap-2 pr-1 border-l border-gray-100 pl-2">
                            <button onclick="toggleFilterPanel()" class="w-10 h-10 rounded-xl flex items-center justify-center hover:bg-orange-50 transition-colors relative group/filter" title="Filter">
                                <span class="material-symbols-outlined text-gray-400 group-hover/filter:text-primary-rust text-[24px]">tune</span>
                                <div id="filter-dot-desktop" class="hidden absolute top-2 right-2.5 w-2 h-2 bg-primary-rust rounded-full ring-2 ring-white"></div>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- CATEGORY NAV -->
            <div id="category-nav" class="py-4 -mx-4 px-4 sm:mx-0 sm:px-0">
                <div class="flex gap-4 md:gap-8 overflow-x-auto hide-scrollbar pb-4 px-1 justify-start md:justify-center">
                    
                    <button class="category-btn group flex flex-col items-center gap-2 md:gap-3 min-w-[80px] shrink-0 focus:outline-none active:scale-95 transition-transform active-tab" data-category="all">
                        <div class="w-[72px] h-[72px] md:w-24 md:h-24 rounded-full bg-white shadow-soft group-[.active-tab]:bg-primary-rust group-[.active-tab]:shadow-lg shadow-orange-500/20 flex items-center justify-center transition-all duration-300 border-2 border-transparent group-[.active-tab]:border-primary-rust overflow-hidden p-1">
                             <img src="https://lh3.googleusercontent.com/aida-public/AB6AXuCZ45_EUYaZRXGCEjhoy96GfQ-qWNEHyhlw-lJ2SbWTty4i_tGRZpIHqnQWH-NpqwnV1RcFleCn_MZxX_0XPLQJd_AlPx9CpxFxazNm6-G1RttAruvA9mAv94vx7kvYcG-YMiOFkBCNtHJjDIo5U0aXT64xlpgenCGtfusvJSb9kFSIzw1cZvPhYpC_a8u50e3xP6X5hHXzcn5BOMKYMDFa0xzj6dY_dq8BGxuBdLy-XJFO7BhmQKo2hG5UKaYeFGCMc-3CVhylLgU" class="w-full h-full object-cover rounded-full opacity-90 group-[.active-tab]:opacity-100">
                        </div>
                        <span class="text-xs md:text-sm font-bold text-earth group-[.active-tab]:text-primary-rust transition-colors font-body">All Items</span>
                    </button>

                    <button class="category-btn group flex flex-col items-center gap-2 md:gap-3 min-w-[80px] shrink-0 focus:outline-none active:scale-95 transition-transform" data-category="rolls">
                        <div class="w-[72px] h-[72px] md:w-24 md:h-24 rounded-full bg-white shadow-soft group-[.active-tab]:bg-primary-rust group-[.active-tab]:shadow-lg shadow-orange-500/20 flex items-center justify-center transition-all duration-300 border-2 border-transparent group-[.active-tab]:border-primary-rust overflow-hidden p-1">
                            <img src="https://lh3.googleusercontent.com/aida-public/AB6AXuBu4XtsPQVQmzt-oply8j5oOkLj49rQG2-Cd5sczoIoNTc099N2jy-G0avyqsFxa4oBx39r79JppJNpVccRit4LN8fO7YQCZnyU-tBxq4qxhRjjTBpRO_-ht-uEUNTanAikYyK1gX2bwVsHyEZoqwDqt3GIOPXgQdqr2fchUMIsFN9bHTdpDO5TWwSTwQhKUb2TUgNDt1QTeR8llO5TTr9XROLj2q_B5YYOQozYQBD8Vh_i24B2PLpIo2vIAHowK5BtsIP4oFdgv90" class="w-full h-full object-cover rounded-full">
                        </div>
                        <span class="text-xs md:text-sm font-bold text-earth group-[.active-tab]:text-primary-rust transition-colors font-body">Rolls</span>
                    </button>

                    <button class="category-btn group flex flex-col items-center gap-2 md:gap-3 min-w-[80px] shrink-0 focus:outline-none active:scale-95 transition-transform" data-category="kebabs">
                        <div class="w-[72px] h-[72px] md:w-24 md:h-24 rounded-full bg-white shadow-soft group-[.active-tab]:bg-primary-rust group-[.active-tab]:shadow-lg shadow-orange-500/20 flex items-center justify-center transition-all duration-300 border-2 border-transparent group-[.active-tab]:border-primary-rust overflow-hidden p-1">
                            <img src="https://lh3.googleusercontent.com/aida-public/AB6AXuBiEJd-nNkflydn5dWe2apbwEymsC7rdQ6Na4dNwBSDpat12CGtLFsje0TmgRCMKb2nwWXZzj9e3DPiiU-LU9a5tlReR3GsLPEKvN1lMrLwXpCOpQT-o2h6hqBP0xbDJ3snj6Q6g7dbLXo9wOpQjJmHzAjaeGbNcvyzmzz_D6vNPCXjbKne7G_CG0vXu9MFlEGTYP6RYWTjrEFhNmzmaIDXpnXOYCYM20VNTMZqmnEXKlnKrnpq6oSJWSf0bZITCxUGKLyIi7S7x9E" class="w-full h-full object-cover rounded-full">
                        </div>
                        <span class="text-xs md:text-sm font-bold text-earth group-[.active-tab]:text-primary-rust transition-colors font-body">Kebabs</span>
                    </button>

                    <button class="category-btn group flex flex-col items-center gap-2 md:gap-3 min-w-[80px] shrink-0 focus:outline-none active:scale-95 transition-transform" data-category="biryani">
                        <div class="w-[72px] h-[72px] md:w-24 md:h-24 rounded-full bg-white shadow-soft group-[.active-tab]:bg-primary-rust group-[.active-tab]:shadow-lg shadow-orange-500/20 flex items-center justify-center transition-all duration-300 border-2 border-transparent group-[.active-tab]:border-primary-rust overflow-hidden p-1">
                            <img src="https://lh3.googleusercontent.com/aida-public/AB6AXuBFx9CZxnWoIJusoPUZgYvjy8IFo6YxqIKMv0fDByrfYXbhjeOdQNi3DJkzGvgPvTV_BFag-NceOGNLa6BsfIdqCoZCOCqkuIl84BJJsDC5S_Pc4DnPl_XTB8yfpAyThMGVG7YU1ubP2GnRO5I6Ijax0pWDFjQn_2vz0PVNiB-kDuNVRvRiMR431QeFHWSTsgAG88LuRxWuTGA9EMgf3YypQTGtQx4j89RCkhSWOFVofuvUdNjYcuC00Eawb1r3csic7VfHBvPy5OE" class="w-full h-full object-cover rounded-full">
                        </div>
                        <span class="text-xs md:text-sm font-bold text-earth group-[.active-tab]:text-primary-rust transition-colors font-body">Biryani</span>
                    </button>

                     <button class="category-btn group flex flex-col items-center gap-2 md:gap-3 min-w-[80px] shrink-0 focus:outline-none active:scale-95 transition-transform" data-category="desserts">
                        <div class="w-[72px] h-[72px] md:w-24 md:h-24 rounded-full bg-white shadow-soft group-[.active-tab]:bg-primary-rust group-[.active-tab]:shadow-lg shadow-orange-500/20 flex items-center justify-center transition-all duration-300 border-2 border-transparent group-[.active-tab]:border-primary-rust overflow-hidden p-1">
                            <img src="https://lh3.googleusercontent.com/aida-public/AB6AXuD4JtH1VdyHqTowcQPBewPtHmnFJhsS6uXEUwIs6lDj6fLXl4NdwMOTqgpTxIiysk5eKnVO0ohjXPHO1wTGz-ZaINTgX-dr4Wis2ZTIfGJY7KJNCD7OaRN70RJJdFkeoVWgG3ZYoE4zxYUNdE38fh8-a7n9gPFjmLioLVw-v7-Q85qeJT_LHQkqklbMQqfs9tYlcONPcTWwvvIosMQI8IpQ0qTZCUrT4ipQWhnKUU0ggb5za4KlDK-GDMlM9HqpWHez_BBwP8Z_8-8" class="w-full h-full object-cover rounded-full">
                        </div>
                        <span class="text-xs md:text-sm font-bold text-earth group-[.active-tab]:text-primary-rust transition-colors font-body">Desserts</span>
                    </button>
                </div>
            </div>

            <!-- MENU GRID -->
            <section class="pb-6">
                <div class="flex items-center justify-between mb-4 px-1">
                    <span id="search-count" class="text-sm font-bold text-primary-rust hidden"></span>
                </div>
                
                <div id="menu-grid" class="grid grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6">
                    <!-- Cards injected by JS -->
                </div>
                
                <div id="no-results" class="hidden flex-col items-center justify-center py-12 text-center">
                    <span class="material-symbols-outlined text-4xl text-gray-300 mb-2">search_off</span>
                    <p class="text-earth font-medium">No dishes found matching your search.</p>
                    <button onclick="clearSearch()" class="mt-4 text-primary-rust font-bold hover:underline">Clear Search</button>
                </div>
            </section>
        </main>

        <!-- FOOTER -->
        <footer class="relative pt-20 pb-28 md:pb-32 overflow-hidden">
            <div class="absolute -bottom-20 left-1/2 -translate-x-1/2 w-[150%] h-[140%] bg-gradient-to-t from-[#FFF0EB] to-transparent -z-10 rounded-t-[50%] opacity-100"></div>
            
            <div class="max-w-4xl mx-auto px-6 text-center relative z-10">
                <h2 class="text-4xl md:text-6xl font-extrabold text-ink font-heading tracking-tight mb-6 leading-[1.1]">
                    Your meal,<br class="md:hidden"> <span class="text-primary-rust">done right.</span>
                </h2>
                
                <p class="text-earth text-base md:text-lg font-medium mb-8 font-body max-w-sm md:max-w-lg mx-auto leading-relaxed">
                    Cooked fresh in our kitchen and delivered straight to your door in minutes.
                </p>
                
                <button onclick="window.scrollTo({top:0, behavior:'smooth'}); document.getElementById('search-input-hero').focus();" 
                    class="bg-primary-rust hover:bg-primary-dark text-white px-10 py-4 rounded-2xl font-bold text-lg shadow-xl shadow-orange-500/20 hover:shadow-orange-500/30 active:scale-95 transition-all duration-200 font-heading inline-flex items-center gap-2 group">
                    Order Now
                    <span class="material-symbols-outlined group-hover:translate-x-1 transition-transform text-[24px]">arrow_forward</span>
                </button>
                
                <div class="mt-12 mb-4 select-none opacity-20">
                    <span class="zwigato-logo text-6xl md:text-8xl text-ink tracking-tighter">Zwigato.</span>
                </div>
                 <p class="text-[10px] text-earth/60 font-bold tracking-[0.2em] uppercase">© 2026 Zwigato. All rights reserved.</p>
            </div>
        </footer>

        <!-- CART FLOATING BAR -->
        <div id="cart-bar" class="fixed bottom-6 left-1/2 -translate-x-1/2 w-[90%] max-w-[800px] z-50 transition-transform duration-300 ease-out translate-y-[200%]">
            <div onclick="showCart()"
                class="bg-[#60b246] hover:bg-[#539e3d] text-white p-3 px-5 rounded-xl shadow-float flex items-center justify-between cursor-pointer group active:scale-[0.99] transition-all">
                
                <div class="flex flex-col">
                    <div class="flex items-baseline gap-2">
                         <span id="cart-count" class="font-extrabold text-sm uppercase tracking-wide">0 ITEMS</span>
                         <span class="opacity-60 text-xs">|</span>
                         <span id="cart-total" class="font-extrabold text-base">₹0</span>
                    </div>
                    <span class="text-[10px] font-medium opacity-90">From Zwigato Kitchen</span>
                </div>

                <div class="flex items-center gap-2 font-bold text-sm uppercase tracking-wide">
                    View Cart
                    <div class="bg-white/20 rounded-full p-1">
                        <span class="material-symbols-outlined text-[16px] block">shopping_bag</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- MOBILE BOTTOM NAV -->
        <nav id="bottom-nav" class="md:hidden fixed bottom-0 left-0 w-full bg-white border-t border-gray-100 pb-safe z-40 shadow-nav">
            <div class="flex justify-around items-center h-[70px] px-2">
                <button class="flex flex-col items-center justify-center w-full h-full gap-1 text-primary-rust">
                    <span class="material-symbols-outlined filled-icon text-[26px]">home</span>
                    <span class="text-[10px] font-bold">Home</span>
                </button>
                <button onclick="document.getElementById('category-nav').scrollIntoView({behavior: 'smooth'})" class="flex flex-col items-center justify-center w-full h-full gap-1 text-gray-400 hover:text-ink transition-colors">
                    <span class="material-symbols-outlined text-[26px]">restaurant_menu</span>
                    <span class="text-[10px] font-medium">Menu</span>
                </button>
                <button onclick="document.getElementById('search-input-hero').focus()" class="flex flex-col items-center justify-center w-full h-full gap-1 text-gray-400 hover:text-ink transition-colors">
                    <span class="material-symbols-outlined text-[26px]">search</span>
                    <span class="text-[10px] font-medium">Search</span>
                </button>
                <button class="flex flex-col items-center justify-center w-full h-full gap-1 text-gray-400 hover:text-ink transition-colors">
                    <span class="material-symbols-outlined text-[26px]">help_outline</span>
                    <span class="text-[10px] font-medium">Help</span>
                </button>
            </div>
        </nav>
    </div> 

    <!-- --- NEW CART VIEW LOGIC (Merged from Cart v0.1) --- -->
    <div id="view-cart" class="fixed inset-0 z-[60] bg-[#F9FAFB] hidden flex flex-col h-full overflow-hidden animate-slideUp">
        <main class="max-w-7xl mx-auto w-full px-4 sm:px-6 lg:px-8 pt-6 grid grid-cols-1 lg:grid-cols-12 gap-8 items-start h-full pb-32 overflow-y-auto custom-scrollbar">
            <div class="lg:col-span-8 space-y-6">
                <!-- Header -->
                <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-2">
                    <div class="flex items-center gap-4">
                        <button class="flex items-center justify-center p-2 rounded-full hover:bg-gray-100 transition-colors" onclick="goHome()">
                            <span class="material-symbols-outlined text-2xl text-gray-900">arrow_back</span>
                        </button>
                        <h1 class="text-3xl font-bold text-gray-900">Your Cart</h1>
                    </div>
                </div>

                <!-- Sections Container -->
                <div id="cart-sections-container" class="space-y-6">
                    <!-- Dynamic Content Injected Here -->
                </div>

                <!-- Notes Section -->
                <div class="bg-white rounded-3xl border border-gray-100 p-6 shadow-sm">
                    <div class="flex items-center gap-2 mb-4 text-gray-900 font-semibold">
                        <span class="material-symbols-outlined text-gray-400">edit_note</span>
                        Cooking Requests
                    </div>
                    <textarea id="order-notes" class="w-full bg-[#F9FAFB] border border-gray-200 rounded-xl p-4 text-sm text-gray-900 placeholder-gray-400 focus:ring-2 focus:ring-primary-rust focus:border-transparent transition-all resize-none h-24 outline-none" placeholder="e.g. Less spicy, no cutlery, allergy info..."></textarea>
                </div>
            </div>

            <!-- Sidebar (Bill Details) -->
            <div class="lg:col-span-4 lg:relative h-full">
                <div class="bg-white rounded-3xl border border-gray-100 p-6 sm:p-8 lg:sticky lg:top-6 shadow-sm transition-colors w-full">
                    <h2 class="text-xl font-bold text-gray-900 mb-6">Bill Details</h2>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center text-gray-500 text-sm">
                            <span>Item Total</span>
                            <span id="cart-view-subtotal" class="font-medium text-gray-900">₹0</span>
                        </div>
                        <div class="flex justify-between items-center text-gray-500 text-sm">
                            <span>Delivery Fee</span>
                            <span class="font-bold text-primary-rust">Free</span>
                        </div>
                        <div class="text-xs text-gray-500 mt-2">
                            GST included in item prices
                        </div>
                    </div>
                    <div class="my-6 border-t border-dashed border-gray-200"></div>
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-lg font-bold text-gray-900">Total</span>
                        <span id="cart-view-total" class="text-2xl font-bold text-gray-900">₹0</span>
                    </div>
                    <p class="text-xs text-gray-500 mb-8">Inclusive of all taxes</p>
                </div>
            </div>
        </main>

        <!-- Floating Footer for Cart -->
        <div class="fixed bottom-0 left-0 w-full bg-white/95 backdrop-blur-md border-t border-gray-100 py-4 z-40">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-4 sm:gap-0">
                <div class="flex flex-row justify-between sm:justify-start items-center sm:flex-col w-full sm:w-auto">
                    <div class="flex flex-col">
                        <p class="text-[10px] text-gray-500 uppercase font-semibold tracking-wider mb-0.5">Total to Pay</p>
                        <div class="flex items-baseline gap-2">
                            <p id="cart-footer-total" class="text-xl sm:text-2xl font-extrabold text-gray-900 tracking-tight">₹0</p>
                        </div>
                    </div>
                    <button onclick="showCheckout()" class="sm:hidden bg-primary-rust hover:bg-primary-dark text-white font-bold py-3 px-6 rounded-2xl shadow-lg shadow-orange-500/20 flex items-center justify-center gap-2 transform active:scale-95 transition-all duration-200">
                        <span class="text-sm">Checkout</span>
                        <span class="material-symbols-outlined text-[18px] font-bold">arrow_forward</span>
                    </button>
                </div>
                <button onclick="showCheckout()" class="hidden sm:flex bg-primary-rust hover:bg-primary-dark text-white font-bold py-3.5 px-8 rounded-2xl shadow-lg shadow-orange-500/20 items-center gap-2 transform active:scale-95 transition-all duration-200 hover:-translate-y-0.5">
                    <span class="text-base">Checkout</span>
                    <span class="material-symbols-outlined text-[20px] font-bold">arrow_forward</span>
                </button>
            </div>
        </div>
    </div>


    <!-- --- NEW CHECKOUT VIEW LOGIC (Merged from Checkout v0.1) --- -->
    <div id="view-checkout" class="fixed inset-0 z-[70] bg-[#FAFAF5] hidden flex flex-col h-full overflow-y-auto custom-scrollbar animate-slideUp">
        <main class="max-w-7xl mx-auto px-4 sm:px-6 py-8 md:py-12 w-full">
            <div class="mb-8 flex items-center gap-4">
                <button onclick="showCart()" class="p-2 -ml-2 rounded-full hover:bg-gray-100 transition-colors text-gray-900">
                    <span class="material-symbols-outlined text-2xl">arrow_back</span>
                </button>
                <h1 class="text-3xl md:text-4xl font-extrabold text-gray-900 tracking-tight">Checkout</h1>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start pb-32">
                <!-- Form Side -->
                <div class="lg:col-span-7 xl:col-span-8">
                    <div class="bg-white rounded-2xl shadow-soft p-6 md:p-8 border border-gray-200">
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">Full Name</label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                        <span class="material-symbols-outlined text-gray-400 text-xl">person</span>
                                    </div>
                                    <input id="input-name" class="block w-full pl-12 pr-4 py-3.5 bg-white border border-gray-200 rounded-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-rust/20 focus:border-primary-rust transition-all duration-200 font-body" placeholder="Enter your full name" type="text"/>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">Phone Number</label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                        <span class="material-symbols-outlined text-gray-400 text-xl">phone</span>
                                    </div>
                                    <input id="input-phone" class="block w-full pl-12 pr-4 py-3.5 bg-white border border-gray-200 rounded-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-rust/20 focus:border-primary-rust transition-all duration-200 font-body" placeholder="+91 999 999 9999" type="tel"/>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-900 mb-2">Delivery Address</label>
                                <div class="relative">
                                    <div class="absolute top-4 left-0 pl-4 flex items-start pointer-events-none">
                                        <span class="material-symbols-outlined text-gray-400 text-xl">home</span>
                                    </div>
                                    <textarea id="input-address" class="block w-full pl-12 pr-4 py-3.5 bg-white border border-gray-200 rounded-xl text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-rust/20 focus:border-primary-rust transition-all duration-200 resize-none font-body" placeholder="Enter your full address" rows="3"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Summary Side (Desktop) -->
                <div class="hidden lg:block lg:col-span-5 xl:col-span-4 sticky top-6">
                    <div class="bg-white rounded-2xl shadow-soft p-6 md:p-8 border border-gray-200">
                        <h2 class="text-xl font-bold text-gray-900 mb-6">Order Summary</h2>
                        <div id="checkout-summary-desktop" class="space-y-6 mb-8">
                            <!-- Dynamic Items -->
                        </div>
                        <div class="border-t border-dashed border-gray-200 mb-8"></div>
                        <h2 class="text-lg font-bold text-gray-900 mb-4">Bill Details</h2>
                        <div class="space-y-3 mb-6 font-body">
                            <div class="flex items-center justify-between text-sm text-gray-500">
                                <span>Item Total</span>
                                <span id="checkout-subtotal-desktop" class="font-medium text-gray-900">₹0</span>
                            </div>
                            <div class="flex items-center justify-between text-sm text-gray-500">
                                <span>Delivery Fee</span>
                                <span class="font-bold text-primary-rust">Free</span>
                            </div>
                            <div class="text-[10px] text-gray-500 mt-1">GST included in item prices</div>
                        </div>
                        <div class="border-t border-dashed border-gray-200 my-4"></div>
                        <div class="flex justify-between items-start mb-1 font-body">
                            <span class="text-lg font-bold text-gray-900">Total</span>
                            <span id="checkout-total-desktop" class="text-xl font-bold text-gray-900">₹0</span>
                        </div>
                        <div class="text-xs text-gray-500 mb-8 font-body">Inclusive of all taxes</div>
                        <div class="hidden md:block">
                            <button onclick="placeOrder()" class="w-full bg-[#25D366] hover:bg-green-600 text-white font-bold py-3 px-6 rounded-full flex items-center justify-center gap-2 shadow-lg shadow-green-500/20 transition-all duration-300 transform hover:-translate-y-0.5 mb-4 font-display">
                                <svg class="w-5 h-5 fill-current" viewBox="0 0 448 512"><path d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7 .9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"></path></svg>
                                <span>Order via WhatsApp</span>
                            </button>
                            <div class="flex items-center justify-center gap-2 text-[10px] text-gray-400 font-body">
                                <span class="material-symbols-outlined text-xs">lock</span>
                                <span>Payments are secured upon delivery</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Mobile Bottom Sheet Overlay -->
        <div class="sheet-overlay fixed inset-0 bg-black/50 z-40 lg:hidden backdrop-blur-[2px]" id="bottomSheetOverlay" onclick="toggleBottomSheet()"></div>

        <!-- Mobile Bottom Sheet Content -->
        <div id="mobileBottomSheet" class="lg:hidden fixed bottom-0 left-0 right-0 z-50 bg-white rounded-t-3xl shadow-sticky-footer transition-all duration-300 ease-out">
            <div onclick="toggleBottomSheet()" class="w-full pt-3 pb-2 flex flex-col items-center justify-center cursor-pointer border-b border-transparent bg-white rounded-t-3xl relative z-20">
                <div class="w-12 h-1.5 bg-gray-300 rounded-full mb-2"></div>
                <span id="expandIcon" class="material-symbols-outlined text-gray-400 transition-transform duration-300">keyboard_arrow_up</span>
            </div>

            <div id="expandedContent" class="max-h-0 overflow-hidden transition-[max-height] duration-500 ease-in-out px-6 bg-white">
                <div class="overflow-y-auto custom-scrollbar pb-6" style="max-height: 50vh;">
                    <h2 class="text-xl font-bold text-gray-900 mb-6">Order Summary</h2>
                    <div id="checkout-summary-mobile" class="space-y-6 mb-8">
                         <!-- Dynamic Items -->
                    </div>
                    <div class="border-t border-dashed border-gray-200 mb-8"></div>
                    <h2 class="text-lg font-bold text-gray-900 mb-4">Bill Details</h2>
                    <div class="space-y-3 mb-2 font-body">
                        <div class="flex items-center justify-between text-sm text-gray-500">
                            <span>Item Total</span>
                            <span id="checkout-subtotal-mobile" class="font-medium text-gray-900">₹0</span>
                        </div>
                        <div class="flex items-center justify-between text-sm text-gray-500">
                            <span>Delivery Fee</span>
                            <span class="font-bold text-primary-rust">Free</span>
                        </div>
                        <div class="text-[10px] text-gray-500 mt-1">GST included in item prices</div>
                    </div>
                </div>
            </div>

            <div class="p-6 pt-2 bg-white border-t border-gray-100 relative z-30">
                <div class="flex justify-between items-center mb-4 cursor-pointer" onclick="toggleBottomSheet()">
                    <div>
                        <span class="block text-lg font-bold text-gray-900 font-display">Total</span>
                        <span class="text-[10px] text-gray-500 font-body">Inclusive of all taxes</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span id="checkout-total-mobile" class="text-xl font-bold text-gray-900 font-body">₹0</span>
                    </div>
                </div>
                
                <button onclick="placeOrder()" class="w-full bg-[#25D366] hover:bg-green-600 text-white font-bold py-3 px-6 rounded-full flex items-center justify-center gap-2 shadow-lg shadow-green-500/20 transition-all duration-300 font-display">
                    <svg class="w-5 h-5 fill-current" viewBox="0 0 448 512"><path d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7 .9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"></path></svg>
                    <span>Order via WhatsApp</span>
                </button>

                <div class="flex items-center justify-center gap-2 text-[10px] text-gray-400 mt-2 font-body">
                    <span class="material-symbols-outlined text-xs">lock</span>
                    <span>Payments are secured upon delivery</span>
                </div>
            </div>
        </div>
    </div>


    <div id="mode-modal" class="fixed inset-0 z-[90] bg-black/60 hidden flex items-center justify-center p-4 backdrop-blur-sm animate-fade">
        <div class="bg-white rounded-2xl w-full max-w-sm p-6 shadow-2xl scale-95 transition-transform duration-200" id="mode-modal-content">
            <h3 class="text-xl font-bold text-ink mb-2 font-heading">Ordering for?</h3>
            <p class="text-earth text-sm mb-6 font-body">Select how you want your food.</p>
            
            <div class="space-y-3">
                <button onclick="resolveModeModal('Delivery')" class="w-full flex items-center justify-between p-4 rounded-xl border border-gray-200 hover:border-primary-rust hover:bg-orange-50 transition-all group">
                    <span class="font-bold text-ink group-hover:text-primary-rust">Delivery</span>
                    <span class="material-symbols-outlined text-gray-400 group-hover:text-primary-rust">two_wheeler</span>
                </button>
                <button onclick="resolveModeModal('Pickup')" class="w-full flex items-center justify-between p-4 rounded-xl border border-gray-200 hover:border-primary-rust hover:bg-orange-50 transition-all group">
                    <span class="font-bold text-ink group-hover:text-primary-rust">Pickup</span>
                    <span class="material-symbols-outlined text-gray-400 group-hover:text-primary-rust">shopping_bag</span>
                </button>
                <button onclick="resolveModeModal('Dine-in')" class="w-full flex items-center justify-between p-4 rounded-xl border border-gray-200 hover:border-primary-rust hover:bg-orange-50 transition-all group">
                    <span class="font-bold text-ink group-hover:text-primary-rust">Dine-in</span>
                    <span class="material-symbols-outlined text-gray-400 group-hover:text-primary-rust">restaurant</span>
                </button>
            </div>
        </div>
    </div>

    <div id="filter-panel" class="fixed inset-0 z-[100] bg-black/50 hidden flex justify-center items-end md:items-center backdrop-blur-sm animate-fade">
        <div class="bg-white w-full max-w-md md:rounded-2xl rounded-t-3xl shadow-2xl flex flex-col max-h-[85vh] animate-slideUp">
            <div class="flex items-center justify-between p-6 border-b border-gray-100">
                <h3 class="text-xl font-bold text-ink font-heading">Filters</h3>
                <button onclick="toggleFilterPanel()" class="w-8 h-8 flex items-center justify-center bg-gray-100 rounded-full text-gray-500 hover:bg-gray-200 transition-colors">
                    <span class="material-symbols-outlined text-[20px]">close</span>
                </button>
            </div>
            
            <div class="p-6 overflow-y-auto space-y-8">
                <div>
                    <h4 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-4">Preference</h4>
                    <div class="flex gap-3">
                        <label class="flex items-center gap-3 cursor-pointer group w-full p-4 border border-gray-200 rounded-xl hover:border-green-600 transition-colors bg-gray-50/50">
                            <input type="checkbox" id="filter-veg" class="peer hidden" onchange="updateFilterState('veg', this.checked)">
                            <div class="w-6 h-6 border-2 border-gray-300 rounded-full peer-checked:bg-green-600 peer-checked:border-green-600 flex items-center justify-center transition-all bg-white">
                                <span class="material-symbols-outlined text-white text-[16px] opacity-0 peer-checked:opacity-100">check</span>
                            </div>
                            <span class="text-base font-bold text-ink group-hover:text-green-600 transition-colors">Veg Only</span>
                        </label>
                    </div>
                </div>

                <div>
                    <h4 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-4">Price Range</h4>
                    <div class="flex flex-wrap gap-3">
                         <button onclick="updateFilterState('price', 'all')" id="price-all" class="price-btn px-5 py-2.5 rounded-full border border-gray-200 text-sm font-bold hover:border-primary-rust hover:text-primary-rust transition-all flex-1">Any</button>
                         <button onclick="updateFilterState('price', 'low')" id="price-low" class="price-btn px-5 py-2.5 rounded-full border border-gray-200 text-sm font-bold hover:border-primary-rust hover:text-primary-rust transition-all flex-1">< ₹100</button>
                         <button onclick="updateFilterState('price', 'mid')" id="price-mid" class="price-btn px-5 py-2.5 rounded-full border border-gray-200 text-sm font-bold hover:border-primary-rust hover:text-primary-rust transition-all flex-1">₹100+</button>
                         <button onclick="updateFilterState('price', 'high')" id="price-high" class="price-btn px-5 py-2.5 rounded-full border border-gray-200 text-sm font-bold hover:border-primary-rust hover:text-primary-rust transition-all flex-1">₹300+</button>
                    </div>
                </div>
            </div>

            <div class="p-6 border-t border-gray-100 flex gap-4 bg-white md:rounded-b-2xl">
                <button onclick="clearFilters()" class="flex-1 py-3.5 rounded-xl border border-gray-200 text-ink font-bold hover:bg-gray-50 transition-all">Clear</button>
                <button onclick="applyFilters()" class="flex-[2] py-3.5 rounded-xl bg-primary-rust text-white font-bold hover:bg-primary-dark shadow-lg shadow-orange-500/20 transition-all">Show Results</button>
            </div>
        </div>
    </div>

    <div id="toast-container"
        class="fixed bottom-32 left-1/2 -translate-x-1/2 z-[80] flex flex-col items-center gap-2 pointer-events-none">
    </div>

    <script>
        /**
         * ZWIGATO - Client Side Logic v0.2
         * Integrated New Cart & Checkout Views
         */

        const MENU_ITEMS = [
            {
                id: "roll-veg-kabab",
                name: "Veg Kabab Paratha Roll",
                category: "rolls",
                price: 30,
                description: "The classic starter. Soft paratha wrapped around spiced veg kababs.",
                image: "https://lh3.googleusercontent.com/aida-public/AB6AXuBu4XtsPQVQmzt-oply8j5oOkLj49rQG2-Cd5sczoIoNTc099N2jy-G0avyqsFxa4oBx39r79JppJNpVccRit4LN8fO7YQCZnyU-tBxq4qxhRjjTBpRO_-ht-uEUNTanAikYyK1gX2bwVsHyEZoqwDqt3GIOPXgQdqr2fchUMIsFN9bHTdpDO5TWwSTwQhKUb2TUgNDt1QTeR8llO5TTr9XROLj2q_B5YYOQozYQBD8Vh_i24B2PLpIo2vIAHowK5BtsIP4oFdgv90",
                isVeg: true,
                tag: "Hook"
            },
            {
                id: "roll-veg-paneer",
                name: "Veg Paneer Kabab Roll",
                category: "rolls",
                price: 40,
                description: "Upgrade to royalty. Soft paneer chunks with our signature spices.",
                image: "https://lh3.googleusercontent.com/aida-public/AB6AXuCTjXzJ_gtW9p5za_LWerjrpAIizMBfPlDFqAgODSuwB3PaMlAmTG1LUcWGMVWD-gEJl6WmYln0GAdtDRbxuLa8swxeUDeVjwBb5M4StIuy8YBZB4kUZ8F3EWDZTTgjD9DLfwI2f17F_31_Xcwepa0qEdp4pi8rt0ViHpd34yV03QLfIQzXAMPAZsGBOGN_wK3sMWNUwQR2vPl_OgeF1AcXI9uKhW44MgB3SjdoPuxln-OHocFqAD8EHz2rpcLWSKgq6dzxmd0FvvM",
                isVeg: true,
                tag: "Bestseller"
            },
            {
                id: "kebab-galouti",
                name: "Galouti Kebab (4 pcs)",
                category: "kebabs",
                price: 320,
                description: "Melt-in-mouth kebabs prepared with 150+ secret spices. The pride of Lucknow.",
                image: "https://lh3.googleusercontent.com/aida-public/AB6AXuBiEJd-nNkflydn5dWe2apbwEymsC7rdQ6Na4dNwBSDpat12CGtLFsje0TmgRCMKb2nwWXZzj9e3DPiiU-LU9a5tlReR3GsLPEKvN1lMrLwXpCOpQT-o2h6hqBP0xbDJ3snj6Q6g7dbLXo9wOpQjJmHzAjaeGbNcvyzmzz_D6vNPCXjbKne7G_CG0vXu9MFlEGTYP6RYWTjrEFhNmzmaIDXpnXOYCYM20VNTMZqmnEXKlnKrnpq6oSJWSf0bZITCxUGKLyIi7S7x9E",
                isVeg: false,
                tag: "Signature"
            },
            {
                id: "biryani-half",
                name: "Awadhi Chicken Biryani (Half)",
                category: "biryani",
                price: 60,
                description: "Long grain basmati rice cooked with succulent chicken and saffron.",
                image: "https://lh3.googleusercontent.com/aida-public/AB6AXuBFx9CZxnWoIJusoPUZgYvjy8IFo6YxqIKMv0fDByrfYXbhjeOdQNi3DJkzGvgPvTV_BFag-NceOGNLa6BsfIdqCoZCOCqkuIl84BJJsDC5S_Pc4DnPl_XTB8yfpAyThMGVG7YU1ubP2GnRO5I6Ijax0pWDFjQn_2vz0PVNiB-kDuNVRvRiMR431QeFHWSTsgAG88LuRxWuTGA9EMgf3YypQTGtQx4j89RCkhSWOFVofuvUdNjYcuC00Eawb1r3csic7VfHBvPy5OE",
                isVeg: false,
                tag: "Must Try"
            },
            {
                id: "biryani-full",
                name: "Awadhi Chicken Biryani (Full)",
                category: "biryani",
                price: 110,
                description: "The complete feast. More pieces, more rice, more happiness.",
                image: "https://lh3.googleusercontent.com/aida-public/AB6AXuBFx9CZxnWoIJusoPUZgYvjy8IFo6YxqIKMv0fDByrfYXbhjeOdQNi3DJkzGvgPvTV_BFag-NceOGNLa6BsfIdqCoZCOCqkuIl84BJJsDC5S_Pc4DnPl_XTB8yfpAyThMGVG7YU1ubP2GnRO5I6Ijax0pWDFjQn_2vz0PVNiB-kDuNVRvRiMR431QeFHWSTsgAG88LuRxWuTGA9EMgf3YypQTGtQx4j89RCkhSWOFVofuvUdNjYcuC00Eawb1r3csic7VfHBvPy5OE",
                isVeg: false,
            },
            {
                id: "nihari",
                name: "Nihari Gosht",
                category: "curries",
                price: 420,
                description: "Slow-cooked stew of meat shank and marrow bones.",
                image: "https://lh3.googleusercontent.com/aida-public/AB6AXuBFx9CZxnWoIJusoPUZgYvjy8IFo6YxqIKMv0fDByrfYXbhjeOdQNi3DJkzGvgPvTV_BFag-NceOGNLa6BsfIdqCoZCOCqkuIl84BJJsDC5S_Pc4DnPl_XTB8yfpAyThMGVG7YU1ubP2GnRO5I6Ijax0pWDFjQn_2vz0PVNiB-kDuNVRvRiMR431QeFHWSTsgAG88LuRxWuTGA9EMgf3YypQTGtQx4j89RCkhSWOFVofuvUdNjYcuC00Eawb1r3csic7VfHBvPy5OE",
                isVeg: false,
            },
            {
                id: "dessert-shahi",
                name: "Shahi Tukda",
                category: "desserts",
                price: 180,
                description: "Bread pudding dessert of fried bread slices soaked in hot milk with spices.",
                image: "https://lh3.googleusercontent.com/aida-public/AB6AXuD4JtH1VdyHqTowcQPBewPtHmnFJhsS6uXEUwIs6lDj6fLXl4NdwMOTqgpTxIiysk5eKnVO0ohjXPHO1wTGz-ZaINTgX-dr4Wis2ZTIfGJY7KJNCD7OaRN70RJJdFkeoVWgG3ZYoE4zxYUNdE38fh8-a7n9gPFjmLioLVw-v7-Q85qeJT_LHQkqklbMQqfs9tYlcONPcTWwvvIosMQI8IpQ0qTZCUrT4ipQWhnKUU0ggb5za4KlDK-GDMlM9HqpWHez_BBwP8Z_8-8",
                isVeg: true,
                tag: "Sweet Ending"
            }
        ];

        const NAWABI_PHRASES = {
            add: ["Wah! Lazeez choice hai Janab!", "Behtareen peshkash!", "Shauk farmayein!"],
            remove: ["Koi baat nahi, kuch aur try karein?", "Dil chota na karein Janab."]
        };

        let cart = {}; 
        let currentCategory = 'all';
        let searchQuery = '';
        let activeFilters = { veg: false, price: 'all' };
        let tempFilters = { ...activeFilters };
        let currentOrderMode = 'Delivery';
        let hasExplicitlySelectedMode = false;
        let detailedCart = {};

        // DOM Elements
        const menuContainer = document.getElementById('menu-grid');
        const cartBar = document.getElementById('cart-bar');
        const cartCount = document.getElementById('cart-count');
        const cartTotal = document.getElementById('cart-total');
        const toastContainer = document.getElementById('toast-container');
        const categoryButtons = document.querySelectorAll('.category-btn');

        // Views
        const viewHome = document.getElementById('view-home');
        const viewCart = document.getElementById('view-cart');
        const viewCheckout = document.getElementById('view-checkout');
        const filterPanel = document.getElementById('filter-panel');
        const cartSectionsContainer = document.getElementById('cart-sections-container');
        const modeModal = document.getElementById('mode-modal');
        const modeModalContent = document.getElementById('mode-modal-content');

        // Config for Cart UI Generation
        const modeConfig = {
            'Delivery': {
                icon: 'two_wheeler',
                bgClass: 'bg-orange-50',
                textClass: 'text-primary-rust',
                activeClass: 'bg-orange-50 text-primary-rust font-bold',
                defaultClass: 'hover:bg-gray-50 text-gray-600 hover:text-gray-900 font-medium'
            },
            'Pickup': {
                icon: 'shopping_bag',
                bgClass: 'bg-orange-50',
                textClass: 'text-primary-rust',
                activeClass: 'bg-orange-50 text-primary-rust font-bold',
                defaultClass: 'hover:bg-gray-50 text-gray-600 hover:text-gray-900 font-medium'
            },
            'Dine-in': {
                icon: 'restaurant',
                bgClass: 'bg-orange-50',
                textClass: 'text-primary-rust',
                activeClass: 'bg-orange-50 text-primary-rust font-bold',
                defaultClass: 'hover:bg-gray-50 text-gray-600 hover:text-gray-900 font-medium'
            }
        };

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            renderMenu();
            updateCartUI();
            setupCategoryFilters();
            updateModeSelectorUI();
            syncFilterUI();
            setupHeaderScroll();
            
            // Close dropdowns on global click
            document.addEventListener('click', function(event) {
                if (!event.target.closest('.dropdown-group')) {
                    document.querySelectorAll('.dropdown-group.active').forEach(group => {
                        group.classList.remove('active');
                        const parentCard = group.closest('.item-card');
                        if(parentCard) parentCard.classList.remove('z-active');
                        const parentSection = group.closest('.section-group');
                        if(parentSection) parentSection.classList.remove('z-priority');
                    });
                }
            });
        });

        // --- MAIN LOGIC ---

        function setupHeaderScroll() {
            const header = document.getElementById('main-header');
            window.addEventListener('scroll', () => {
                if (window.scrollY > 10) {
                    header.classList.add('bg-white/80', 'backdrop-blur-md', 'shadow-sm', 'border-gray-100/50');
                    header.classList.remove('bg-[#FFF0EB]', 'border-transparent');
                } else {
                    header.classList.remove('bg-white/80', 'backdrop-blur-md', 'shadow-sm', 'border-gray-100/50');
                    header.classList.add('bg-[#FFF0EB]', 'border-transparent');
                }
            });
        }

        // Location Dropdown
        function toggleLocationDropdown(event) {
            if(event) event.stopPropagation();
            const dropdown = document.getElementById('location-dropdown');
            const chevron = document.getElementById('location-chevron');
            
            if (dropdown.classList.contains('hidden')) {
                dropdown.classList.remove('hidden');
                dropdown.classList.add('animate-dropdown-enter');
                chevron.classList.add('rotate-180');
            } else {
                dropdown.classList.add('hidden');
                dropdown.classList.remove('animate-dropdown-enter');
                chevron.classList.remove('rotate-180');
            }
        }

        function updateLocation(newLocation) {
            document.getElementById('current-location').innerText = newLocation;
            document.getElementById('location-dropdown').classList.add('hidden');
            document.getElementById('location-chevron').classList.remove('rotate-180');
        }

        // --- CART RENDER LOGIC (REFINED) ---
        function renderMenu() {
            menuContainer.innerHTML = '';
            let itemsToShow = currentCategory === 'all'
                ? MENU_ITEMS
                : MENU_ITEMS.filter(item => item.category === currentCategory);

            if (searchQuery) {
                const query = searchQuery.toLowerCase();
                itemsToShow = itemsToShow.filter(item => 
                    item.name.toLowerCase().includes(query) || 
                    item.description.toLowerCase().includes(query) ||
                    item.category.toLowerCase().includes(query)
                );
            }

            if (activeFilters.veg) itemsToShow = itemsToShow.filter(item => item.isVeg);
            if (activeFilters.price !== 'all') {
                itemsToShow = itemsToShow.filter(item => {
                    if (activeFilters.price === 'low') return item.price < 100;
                    if (activeFilters.price === 'mid') return item.price >= 100 && item.price <= 300;
                    if (activeFilters.price === 'high') return item.price > 300;
                    return true;
                });
            }

            const noResults = document.getElementById('no-results');
            const searchCount = document.getElementById('search-count');
            
            if (itemsToShow.length === 0) {
                noResults.classList.remove('hidden');
                noResults.classList.add('flex');
                if(searchQuery) searchCount.innerText = '';
            } else {
                noResults.classList.add('hidden');
                noResults.classList.remove('flex');
                if(searchQuery) {
                    searchCount.classList.remove('hidden');
                    searchCount.innerText = `Found ${itemsToShow.length} matches`;
                } else {
                    searchCount.classList.add('hidden');
                }
            }

            itemsToShow.forEach(item => {
                const cartQty = cart[item.id] || 0;
                const card = document.createElement('div');
                card.className = "bg-white rounded-2xl shadow-soft border border-transparent hover:border-gray-100 overflow-hidden group flex flex-col h-full";

                card.innerHTML = `
                    <div class="relative w-full aspect-[4/3] overflow-hidden bg-gray-50">
                        <img src="${item.image}" alt="${item.name}" class="w-full h-full object-cover">
                        ${item.tag ? `<div class="absolute top-2 left-2 bg-white/95 backdrop-blur px-2 py-0.5 rounded-[6px] text-[10px] font-bold shadow-sm uppercase tracking-wider text-primary-rust font-body">${item.tag}</div>` : ''}
                        ${item.isVeg 
                            ? `<div class="absolute bottom-2 right-2 bg-white/90 p-1 rounded-[4px] shadow-sm"><div class="border border-green-600 p-0.5 rounded-[2px] flex items-center justify-center w-3 h-3"><div class="w-1.5 h-1.5 bg-green-600 rounded-full"></div></div></div>` 
                            : `<div class="absolute bottom-2 right-2 bg-white/90 p-1 rounded-[4px] shadow-sm"><div class="border border-primary-rust p-0.5 rounded-[2px] flex items-center justify-center w-3 h-3"><div class="w-1.5 h-1.5 bg-primary-rust rounded-full"></div></div></div>`
                        }
                    </div>
                    
                    <div class="p-3 flex flex-col flex-grow">
                        <h3 class="font-bold text-[15px] text-ink leading-tight mb-1 line-clamp-2 font-heading">${item.name}</h3>
                        <p class="text-[11px] text-gray-400 mb-3 line-clamp-2 font-body leading-relaxed">${item.description}</p>
                        <div class="mt-auto flex items-center justify-between">
                            <span class="font-bold text-[16px] text-ink font-heading">₹${item.price}</span>
                            ${cartQty === 0 ? `
                                <button onclick="addToCart('${item.id}')" class="h-8 px-5 bg-white border border-gray-200 text-primary-rust text-xs font-bold rounded-lg hover:border-primary-rust hover:bg-[#FFF6F3] transition-all shadow-sm uppercase tracking-wide">ADD</button>
                            ` : `
                                <div class="flex items-center h-8 bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm">
                                    <button onclick="updateQuantity('${item.id}', -1)" class="w-8 h-full flex items-center justify-center text-earth hover:bg-gray-50 font-bold">-</button>
                                    <span class="w-6 text-center text-xs font-bold text-primary-rust">${cartQty}</span>
                                    <button onclick="updateQuantity('${item.id}', 1)" class="w-8 h-full flex items-center justify-center text-primary-rust hover:bg-gray-50 font-bold">+</button>
                                </div>
                            `}
                        </div>
                    </div>
                `;
                menuContainer.appendChild(card);
            });
        }

        // --- NEW CART LOGIC (Sectioned Rendering) ---
        function renderCartList() {
            cartSectionsContainer.innerHTML = '';
            
            if (Object.keys(cart).length === 0) {
                cartSectionsContainer.innerHTML = `<div class="text-center py-12 text-gray-400 font-medium">Your cart is empty...</div>`;
                return;
            }

            const modes = ['Delivery', 'Pickup', 'Dine-in'];
            let hasItems = false;

            modes.forEach(mode => {
                const itemsInMode = [];
                Object.keys(detailedCart).forEach(itemId => {
                    if (detailedCart[itemId][mode] > 0) {
                        itemsInMode.push({ id: itemId, qty: detailedCart[itemId][mode] });
                    }
                });

                if (itemsInMode.length > 0) {
                    hasItems = true;
                    // Create Section
                    const section = document.createElement('div');
                    section.className = "bg-white rounded-3xl border border-gray-100 overflow-visible transition-colors shadow-sm relative z-20 section-group";
                    
                    // Header
                    section.innerHTML = `
                        <div class="p-6 border-b border-gray-100 flex items-start gap-4">
                            <div class="w-12 h-12 rounded-full ${modeConfig[mode].bgClass} flex items-center justify-center ${modeConfig[mode].textClass} shrink-0">
                                <span class="material-symbols-outlined">${modeConfig[mode].icon}</span>
                            </div>
                            <div>
                                <h2 class="text-lg font-bold text-gray-900">${mode} Items</h2>
                                <p class="text-sm text-gray-500">${getModeSubtitle(mode)}</p>
                            </div>
                        </div>
                        <div class="items-container"></div>
                    `;

                    const itemsContainer = section.querySelector('.items-container');

                    itemsInMode.forEach(({ id, qty }) => {
                        const item = MENU_ITEMS.find(i => i.id === id);
                        const card = document.createElement('div');
                        card.className = "item-card p-4 sm:p-6 flex gap-4 sm:gap-6 border-b border-gray-100 last:border-0 hover:bg-gray-50 transition-colors overflow-visible relative items-center z-10";
                        
                        // Generate Dropdown Options Logic
                        let dropdownHtml = '';
                        modes.forEach(m => {
                            const isCurrent = m === mode;
                            const btnClass = isCurrent ? modeConfig[m].activeClass : modeConfig[m].defaultClass;
                            dropdownHtml += `
                                <button onclick="moveItemMode('${id}', '${mode}', '${m}')" class="w-full flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm transition-colors text-left font-inter ${btnClass}">
                                    <span class="material-symbols-outlined text-[18px]">${modeConfig[m].icon}</span>
                                    ${m}
                                </button>
                            `;
                        });

                        card.innerHTML = `
                            <div class="w-20 h-20 sm:w-24 sm:h-24 rounded-2xl overflow-hidden shrink-0 relative">
                                <img alt="${item.name}" class="w-full h-full object-cover" src="${item.image}"/>
                            </div>
                            <div class="flex-1 flex flex-col justify-center min-w-0">
                                <div class="flex justify-between items-start mb-2">
                                    <h3 class="text-lg font-semibold text-gray-900 truncate pr-2">${item.name}</h3>
                                    <span class="text-lg font-bold text-gray-900 shrink-0">₹${item.price * qty}</span>
                                </div>
                                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
                                    <div class="flex items-center gap-2 flex-wrap relative z-30">
                                        <div class="relative dropdown-group font-inter">
                                            <button onclick="toggleDropdown(this)" class="trigger-btn flex items-center gap-2 px-3 py-1.5 bg-white hover:bg-gray-50 rounded-full transition-colors group cursor-pointer border ring-1 ring-gray-100 shadow-sm border-transparent focus:border-primary-rust/30 outline-none">
                                                <span class="material-symbols-outlined text-[18px] ${modeConfig[mode].textClass}">${modeConfig[mode].icon}</span>
                                                <span class="text-xs font-bold text-ink">${mode}</span>
                                                <span class="material-symbols-outlined text-[16px] text-gray-400 group-hover:text-gray-600 transition-transform duration-200 group-focus:rotate-180">expand_more</span>
                                            </button>
                                            <div class="dropdown-menu absolute top-full left-0 mt-2 w-48 bg-white rounded-2xl shadow-xl border border-gray-100 p-2 opacity-0 invisible transform -translate-y-2 transition-all duration-200 z-50 origin-top-left">
                                                <div class="flex flex-col gap-1">
                                                    ${dropdownHtml}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex items-center border border-gray-200 rounded-lg px-2 py-1 bg-white self-end sm:self-auto">
                                        <button class="text-gray-400 hover:text-primary-rust transition-colors px-2" onclick="updateCartModeQuantity('${item.id}', '${mode}', -1)">-</button>
                                        <span class="font-semibold w-6 text-center text-gray-900 text-sm">${qty}</span>
                                        <button class="text-primary-rust hover:text-primary-dark transition-colors px-2" onclick="updateCartModeQuantity('${item.id}', '${mode}', 1)">+</button>
                                    </div>
                                </div>
                            </div>
                        `;
                        itemsContainer.appendChild(card);
                    });
                    cartSectionsContainer.appendChild(section);
                }
            });
        }

        function getModeSubtitle(mode) {
            if (mode === 'Delivery') return 'Delivered to Home';
            if (mode === 'Pickup') return 'Pick up at Counter';
            return 'Serve at Table';
        }

        function toggleDropdown(button) {
            const group = button.closest('.dropdown-group');
            const itemCard = button.closest('.item-card');
            const sectionGroup = button.closest('.section-group');
            
            const isActive = group.classList.contains('active');
            
            // Close others
            document.querySelectorAll('.dropdown-group.active').forEach(activeGroup => {
                activeGroup.classList.remove('active');
                const parentCard = activeGroup.closest('.item-card');
                if(parentCard) parentCard.classList.remove('z-active');
                const parentSection = activeGroup.closest('.section-group');
                if(parentSection) parentSection.classList.remove('z-priority');
            });
            
            if (!isActive) {
                group.classList.add('active');
                if(itemCard) itemCard.classList.add('z-active');
                if(sectionGroup) sectionGroup.classList.add('z-priority');
            } else {
                group.classList.remove('active');
                if(itemCard) itemCard.classList.remove('z-active');
                if(sectionGroup) sectionGroup.classList.remove('z-priority');
            }
        }

        // --- GLOBAL CART LOGIC ---
        function addToCart(itemId, silence = false) {
            const isFirstAdd = Object.keys(cart).length === 0;
            if (isFirstAdd && !hasExplicitlySelectedMode) {
                pendingItemId = itemId;
                showModeModal();
                return;
            }

            if (!cart[itemId]) cart[itemId] = 0;
            cart[itemId]++;

            if (!detailedCart[itemId]) detailedCart[itemId] = {};
            if (!detailedCart[itemId][currentOrderMode]) detailedCart[itemId][currentOrderMode] = 0;
            
            detailedCart[itemId][currentOrderMode]++;

            if (!silence) speak(NAWABI_PHRASES.add);

            updateCartUI();
            renderMenu();
        }

        function updateQuantity(itemId, change) {
            if (!cart[itemId]) return;

            if (change > 0) {
                if (!detailedCart[itemId]) detailedCart[itemId] = {};
                if (!detailedCart[itemId][currentOrderMode]) detailedCart[itemId][currentOrderMode] = 0;
                detailedCart[itemId][currentOrderMode]++;
                cart[itemId]++;
            } else {
                if (detailedCart[itemId] && detailedCart[itemId][currentOrderMode] > 0) {
                    detailedCart[itemId][currentOrderMode]--;
                    cart[itemId]--;
                } else {
                    const modes = Object.keys(detailedCart[itemId]);
                    for (let m of modes) {
                        if (detailedCart[itemId][m] > 0) {
                            detailedCart[itemId][m]--;
                            cart[itemId]--;
                            break;
                        }
                    }
                }
            }

            if (cart[itemId] <= 0) {
                delete cart[itemId];
                delete detailedCart[itemId];
                speak(NAWABI_PHRASES.remove);
            }

            updateCartUI();
            renderMenu();
            renderCartList(); // Refresh cart view if open
        }

        function updateCartModeQuantity(itemId, mode, change) {
            if (!detailedCart[itemId]) detailedCart[itemId] = {};
            if (!detailedCart[itemId][mode]) detailedCart[itemId][mode] = 0;

            detailedCart[itemId][mode] += change;
            cart[itemId] += change;

            if (detailedCart[itemId][mode] <= 0) {
                delete detailedCart[itemId][mode];
            }
            if (cart[itemId] <= 0) {
                delete cart[itemId];
                delete detailedCart[itemId];
                speak(NAWABI_PHRASES.remove);
            }

            updateCartUI();
            renderMenu();
            renderCartList();
        }

        function moveItemMode(itemId, oldMode, newMode) {
            if (oldMode === newMode) return;
            
            if (detailedCart[itemId] && detailedCart[itemId][oldMode] > 0) {
                 detailedCart[itemId][oldMode]--;
                 
                 if (!detailedCart[itemId][newMode]) detailedCart[itemId][newMode] = 0;
                 detailedCart[itemId][newMode]++;
                 
                 if (detailedCart[itemId][oldMode] <= 0) delete detailedCart[itemId][oldMode];
            }
            
            updateCartUI();
            renderCartList();
        }

        function updateCartUI() {
            const totalQty = Object.values(cart).reduce((a, b) => a + b, 0);
            const totalPrice = Object.entries(cart).reduce((sum, [id, qty]) => {
                const item = MENU_ITEMS.find(i => i.id === id);
                return sum + (item.price * qty);
            }, 0);

            if (totalQty > 0) {
                cartBar.classList.remove('translate-y-[200%]');
                cartCount.innerText = `${totalQty} ITEM${totalQty > 1 ? 'S' : ''}`;
                cartTotal.innerText = `\u20B9${totalPrice}`;
            } else {
                cartBar.classList.add('translate-y-[200%]');
            }

            const formattedTotal = `\u20B9${totalPrice}`;
            // Update Cart View Totals
            document.getElementById('cart-view-subtotal').innerText = formattedTotal;
            document.getElementById('cart-view-total').innerText = formattedTotal;
            document.getElementById('cart-footer-total').innerText = formattedTotal;
            
            // Update Checkout View Totals (Desktop & Mobile)
            document.getElementById('checkout-subtotal-desktop').innerText = formattedTotal;
            document.getElementById('checkout-total-desktop').innerText = formattedTotal;
            document.getElementById('checkout-subtotal-mobile').innerText = formattedTotal;
            document.getElementById('checkout-total-mobile').innerText = formattedTotal;
        }

        function showCart() {
            renderCartList();
            viewCart.classList.remove('hidden');
            viewCheckout.classList.add('hidden');
            document.body.style.overflow = 'hidden';
        }

        function goHome() {
            viewCart.classList.add('hidden');
            viewCheckout.classList.add('hidden');
            document.body.style.overflow = '';
        }

        // --- CHECKOUT LOGIC ---
        function showCheckout() {
            const totalQty = Object.values(cart).reduce((a, b) => a + b, 0);
            if (totalQty === 0) {
                showToast("Cart is empty Janab!");
                return;
            }
            
            renderCheckoutSummary('checkout-summary-desktop');
            renderCheckoutSummary('checkout-summary-mobile');
            
            viewCheckout.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function renderCheckoutSummary(containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            Object.keys(cart).forEach(id => {
                if (cart[id] > 0) {
                    const item = MENU_ITEMS.find(i => i.id === id);
                    const el = document.createElement('div');
                    el.className = "flex items-center gap-4";
                    el.innerHTML = `
                        <div class="relative w-16 h-16 flex-shrink-0">
                            <img alt="${item.name}" class="w-full h-full object-cover rounded-xl shadow-sm" src="${item.image}"/>
                            <span class="absolute -top-2 -right-2 bg-gray-900 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full">${cart[id]}</span>
                        </div>
                        <div class="flex-grow flex justify-between items-center">
                            <h3 class="font-bold text-sm text-gray-900 pr-2 font-display">${item.name}</h3>
                            <span class="font-bold text-sm text-gray-900 font-body">₹${item.price * cart[id]}</span>
                        </div>
                    `;
                    container.appendChild(el);
                }
            });
        }
        
        function toggleBottomSheet() {
            const overlay = document.getElementById('bottomSheetOverlay');
            const content = document.getElementById('expandedContent');
            const icon = document.getElementById('expandIcon');
            
            const isExpanded = content.style.maxHeight !== "" && content.style.maxHeight !== "0px";

            if (isExpanded) {
                content.style.maxHeight = "0px";
                overlay.classList.remove('active');
                icon.style.transform = "rotate(0deg)";
            } else {
                content.style.maxHeight = "50vh"; // Fixed height approx
                overlay.classList.add('active');
                icon.style.transform = "rotate(180deg)";
            }
        }

        function placeOrder() {
            const name = document.getElementById('input-name').value.trim();
            const phone = document.getElementById('input-phone').value.trim();
            const address = document.getElementById('input-address').value.trim();
            const notes = document.getElementById('order-notes').value.trim();

            if (!name || !phone) {
                showToast("Please enter Name & Phone number!");
                return;
            }

            let message = `*New Order from ${name}*\n`;
            message += `Phone: ${phone}\n`;
            if (address) message += `Address: ${address}\n`;
            message += `----------------\n`;

            let total = 0;
            const modes = ['Delivery', 'Pickup', 'Dine-in'];
            
            modes.forEach(mode => {
                let hasItems = false;
                let sectionTotal = 0;
                let sectionMsg = `\n*--- ${mode} Items ---*\n`;
                
                Object.keys(detailedCart).forEach(id => {
                    const qty = detailedCart[id][mode] || 0;
                    if (qty > 0) {
                        hasItems = true;
                        const item = MENU_ITEMS.find(i => i.id === id);
                        const itemTotal = item.price * qty;
                        sectionTotal += itemTotal;
                        total += itemTotal;
                        sectionMsg += `${qty}x ${item.name} - \u20B9${itemTotal}\n`;
                    }
                });
                
                if (hasItems) {
                    message += sectionMsg;
                }
            });

            message += `----------------\n`;
            message += `*Total Bill: \u20B9${total}*\n`;
            if (notes) message += `Instructions: ${notes}\n`;

            const encodedMsg = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/919876543210?text=${encodedMsg}`;

            window.open(whatsappUrl, '_blank');
        }

        // --- UTILS & FILTER LOGIC ---
        function handleSearch(query) {
            searchQuery = query.trim();
            const heroInput = document.getElementById('search-input-hero');
            if(heroInput && heroInput.value !== searchQuery) heroInput.value = searchQuery;
            if(searchQuery) {
                document.getElementById('category-nav').scrollIntoView({behavior: 'smooth'});
            }
            renderMenu();
        }

        function clearSearch() {
            handleSearch('');
        }

        function toggleFilterPanel() {
            if (filterPanel.classList.contains('hidden')) {
                filterPanel.classList.remove('hidden');
                tempFilters = { ...activeFilters };
                syncFilterUI();
            } else {
                filterPanel.classList.add('hidden');
            }
        }

        function updateFilterState(type, value) {
            tempFilters[type] = value;
            syncFilterUI();
        }

        function syncFilterUI() {
            document.getElementById('filter-veg').checked = tempFilters.veg;
            document.querySelectorAll('.price-btn').forEach(btn => {
                btn.classList.remove('bg-primary-rust', 'text-white', 'border-primary-rust');
                btn.classList.add('bg-white', 'border-gray-200', 'text-ink');
                if (btn.id === `price-${tempFilters.price}`) {
                    btn.classList.remove('bg-white', 'border-gray-200', 'text-ink');
                    btn.classList.add('bg-primary-rust', 'text-white', 'border-primary-rust');
                }
            });
        }

        function applyFilters() {
            activeFilters = { ...tempFilters };
            toggleFilterPanel();
            renderMenu();
            updateFilterIndicators();
        }

        function clearFilters() {
            tempFilters = { veg: false, price: 'all' };
            applyFilters();
        }

        function updateFilterIndicators() {
            const hasFilters = activeFilters.veg || activeFilters.price !== 'all';
            const desktopDot = document.getElementById('filter-dot-desktop');
            if (hasFilters) desktopDot.classList.remove('hidden');
            else desktopDot.classList.add('hidden');
        }
        
        function setGlobalOrderMode(mode) {
            currentOrderMode = mode;
            hasExplicitlySelectedMode = true;
            updateModeSelectorUI();
            toggleModeDropdown();
        }

        function updateModeSelectorUI() {
            const label = document.getElementById('trigger-label');
            const icon = document.getElementById('trigger-icon');
            if(label && icon) {
                label.innerText = currentOrderMode;
                icon.innerText = modeConfig[currentOrderMode].icon;
            }
            const buttons = document.querySelectorAll('#mode-dropdown button');
            buttons.forEach(btn => {
                const modeName = btn.querySelector('.text-sm').innerText;
                const iconSpan = btn.querySelector('.material-symbols-outlined');
                const textSpan = btn.querySelector('.text-sm');
                if (modeName === currentOrderMode) {
                    btn.classList.add('bg-orange-50');
                    iconSpan.classList.replace('text-gray-400', 'text-primary-rust');
                    textSpan.classList.replace('text-ink', 'text-primary-rust');
                } else {
                    btn.classList.remove('bg-orange-50');
                    iconSpan.classList.replace('text-primary-rust', 'text-gray-400');
                    textSpan.classList.replace('text-primary-rust', 'text-ink');
                }
            });
        }

        function toggleModeDropdown(event) {
            if(event) event.stopPropagation();
            const dropdown = document.getElementById('mode-dropdown');
            const chevron = document.getElementById('trigger-chevron');
            if (dropdown.classList.contains('hidden')) {
                dropdown.classList.remove('hidden');
                dropdown.classList.add('animate-dropdown-enter');
                chevron.classList.add('rotate-180');
            } else {
                dropdown.classList.add('hidden');
                dropdown.classList.remove('animate-dropdown-enter');
                chevron.classList.remove('rotate-180');
            }
        }

        function handleBodyClick(event) {
            const dropdown = document.getElementById('mode-dropdown');
            const trigger = document.getElementById('mode-trigger');
            if (dropdown && !dropdown.classList.contains('hidden') && !trigger.contains(event.target) && !dropdown.contains(event.target)) {
                 dropdown.classList.add('hidden');
                 document.getElementById('trigger-chevron').classList.remove('rotate-180');
            }
            const locDropdown = document.getElementById('location-dropdown');
            const locTrigger = document.getElementById('location-trigger');
            if (locDropdown && !locDropdown.classList.contains('hidden') && !locTrigger.contains(event.target) && !locDropdown.contains(event.target)) {
                 locDropdown.classList.add('hidden');
                 document.getElementById('location-chevron').classList.remove('rotate-180');
            }
        }

        let pendingItemId = null;
        function showModeModal() {
            modeModal.classList.remove('hidden');
            setTimeout(() => {
                modeModalContent.classList.remove('scale-95');
                modeModalContent.classList.add('scale-100');
            }, 10);
        }

        function resolveModeModal(mode) {
            setGlobalOrderMode(mode);
            modeModal.classList.add('hidden');
            if (pendingItemId) {
                addToCart(pendingItemId, true);
                pendingItemId = null;
            }
        }

        function setupCategoryFilters() {
            categoryButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    categoryButtons.forEach(b => b.classList.remove('active-tab'));
                    btn.classList.add('active-tab');
                    currentCategory = btn.dataset.category;
                    renderMenu();
                });
            });
        }

        function speak(phrasesArray) {
            const phrase = phrasesArray[Math.floor(Math.random() * phrasesArray.length)];
            showToast(phrase);
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = "transform transition-all duration-500 translate-y-10 opacity-0 bg-[#333333] text-white px-6 py-3 rounded-full shadow-lg flex items-center gap-3 border border-gray-700 min-w-max z-[100]";
            toast.innerHTML = `<span class="tracking-wide text-sm font-medium font-body">${message}</span>`;
            toastContainer.appendChild(toast);
            requestAnimationFrame(() => toast.classList.remove('translate-y-10', 'opacity-0'));
            setTimeout(() => {
                toast.classList.add('translate-y-10', 'opacity-0');
                setTimeout(() => toast.remove(), 500);
            }, 3000);
        }
    </script>
</body>
</html>
